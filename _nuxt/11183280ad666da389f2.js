(window.webpackJsonp=window.webpackJsonp||[]).push([[2,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],{336:function(t,n,e){var map={"./anchor-phising/index.md":337,"./apache-security-header/index.md":341,"./centos-apache-https-server/index.md":342,"./docker-memo/index.md":343,"./https-basic-memo/index.md":344,"./mac-dev-tips/index.md":345,"./php-empty/index.md":357,"./php-suck-bom-utf8/index.md":346,"./postgres-current-transaction-is-aborted/index.md":347,"./postgres-memo/index.md":348,"./shell-postgres-transaction-control/index.md":349,"./thu-tuc-gui-tre/index.md":350,"./thu-tuc-moi-gia-dinh-sang-nhat-choi/index.md":351,"./thue-nha-o-nhat/index.md":352,"./web-application-security-checklist/index.md":353,"./windows-case-insensitive-problem/index.md":354};function c(t){var n=r(t);return e(n)}function r(t){if(!e.o(map,t)){var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}return map[t]}c.keys=function(){return Object.keys(map)},c.resolve=r,t.exports=c,c.id=336},337:function(t,n,e){const c={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,c=t._self._c||n;return c("div",{staticClass:"frontmatter-markdown"},[c("p",[t._v("バーナーとかで他サイトと連携することが普通だが、無害と考えているのに、不注意すると脆弱性がでてくることはご存じですか。"),c("br"),t._v("\n意外と見逃しがちの攻撃なので、メモしておきます。")]),t._v(" "),c("h2",[t._v("問題")]),t._v(" "),c("p",[c("strong",[t._v("a")]),t._v("タグで他サイトへ遷移する時に、遷移先ページでは現ページの"),c("code",{pre:!0},[t._v("location")]),t._v("オブジェクトにアクセスができてしまって、"),c("br"),t._v("\n悪質なアクションを行うことができる。")]),t._v(" "),c("h2",[t._v("具体的どんなことが起こりえる")]),t._v(" "),c("ol",[c("li",[c("p",[t._v("あなたのサイトに他サイト遷移のリンク配置")])]),t._v(" "),c("li",[c("p",[t._v("ユーザーはリンクをクリックして、新しいタブで開く")])]),t._v(" "),c("li",[c("p",[t._v("ユーザーはあなたのサイトのタブに戻る  "),c("br"),t._v(" "),c("strong",[t._v("3")]),t._v("は知らないうちに、あなたとのそっくりページが表示されている！！！")])]),t._v(" "),c("li",[c("p",[t._v("あなとのサイトへアクセスする"),c("br"),t._v(" "),c("img",{attrs:{src:e(338),alt:""}})])]),t._v(" "),c("li",[c("p",[c("strong",[t._v("スポンサーページ")]),t._v("をクリックし、"),c("strong",[t._v("○○株式会社")]),t._v("サイトへアクセスする"),c("br"),t._v(" "),c("img",{attrs:{src:e(339),alt:""}})])]),t._v(" "),c("li",[c("p",[c("strong",[t._v("1")]),t._v("のタブに戻って、"),c("strong",[t._v("ログイン")]),t._v("をする"),c("br"),t._v(" "),c("img",{attrs:{src:e(340),alt:""}})])])]),t._v(" "),c("p",[t._v("ここで変わった点を気づいたか")]),t._v(" "),c("ul",[c("li",[t._v("リンクURL："),c("strong",[t._v("yoursite.com")]),t._v(" -> "),c("strong",[t._v("y0ursite.com")])]),t._v(" "),c("li",[t._v("画面がそっくりだね。（デモの目的でメッセージを出したけど）")])]),t._v(" "),c("h2",[t._v("対策")]),t._v(" "),c("ul",[c("li",[c("strong",[t._v("a")]),t._v("タグに "),c("strong",[t._v('rel="noopener noreferrer"')]),t._v(" 属性を追加")])]),t._v(" "),c("h2",[t._v("まとめ")]),t._v(" "),c("ul",[c("li",[t._v('外部ページへアクセスするリンクは全て**rel="noopener noreferrer"**に設定すること')]),t._v(" "),c("li",[t._v("本脆弱性は自サイトの問題ではなく、連携先側で攻撃を受けられた際、悪影響を及ぼす対策の必要なものである。")])])])}]};t.exports={attributes:{title:"Anchor Phishing",date:"2018-08-18T00:00:00.000Z",description:"アンコータグ（aタグ)の設定不良で攻撃リスクがあるのを知っていますか。セキュリティ調べる時に発見し為、メモします。",thumbnail:"posts/phishing.png",tags:["security"]},html:'<p>バーナーとかで他サイトと連携することが普通だが、無害と考えているのに、不注意すると脆弱性がでてくることはご存じですか。<br>\n意外と見逃しがちの攻撃なので、メモしておきます。</p>\n<h2>問題</h2>\n<p><strong>a</strong>タグで他サイトへ遷移する時に、遷移先ページでは現ページの<code>location</code>オブジェクトにアクセスができてしまって、<br>\n悪質なアクションを行うことができる。</p>\n<h2>具体的どんなことが起こりえる</h2>\n<ol>\n<li>\n<p>あなたのサイトに他サイト遷移のリンク配置</p>\n</li>\n<li>\n<p>ユーザーはリンクをクリックして、新しいタブで開く</p>\n</li>\n<li>\n<p>ユーザーはあなたのサイトのタブに戻る  <br>\n<strong>3</strong>は知らないうちに、あなたとのそっくりページが表示されている！！！</p>\n</li>\n<li>\n<p>あなとのサイトへアクセスする<br>\n<img src="./1.png" alt=""></p>\n</li>\n<li>\n<p><strong>スポンサーページ</strong>をクリックし、<strong>○○株式会社</strong>サイトへアクセスする<br>\n<img src="./2.png" alt=""></p>\n</li>\n<li>\n<p><strong>1</strong>のタブに戻って、<strong>ログイン</strong>をする<br>\n<img src="./3.png" alt=""></p>\n</li>\n</ol>\n<p>ここで変わった点を気づいたか</p>\n<ul>\n<li>リンクURL：<strong>yoursite.com</strong> -&gt; <strong>y0ursite.com</strong></li>\n<li>画面がそっくりだね。（デモの目的でメッセージを出したけど）</li>\n</ul>\n<h2>対策</h2>\n<ul>\n<li><strong>a</strong>タグに <strong>rel=&quot;noopener noreferrer&quot;</strong> 属性を追加</li>\n</ul>\n<h2>まとめ</h2>\n<ul>\n<li>外部ページへアクセスするリンクは全て**rel=&quot;noopener noreferrer&quot;**に設定すること</li>\n<li>本脆弱性は自サイトの問題ではなく、連携先側で攻撃を受けられた際、悪影響を及ぼす対策の必要なものである。</li>\n</ul>\n',meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/anchor-phising/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=c.render,this.$options.staticRenderFns=c.staticRenderFns}}}}},338:function(t,n,e){t.exports=e.p+"img/d46eab9.png"},339:function(t,n,e){t.exports=e.p+"img/7ecc299.png"},340:function(t,n,e){t.exports=e.p+"img/93a9415.png"},341:function(t,n){const e={render:function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("h1",[t._v("All about Apache HTTP Security Header")]),t._v(" "),e("h2",[t._v("X-XSS-Protection")]),t._v(" "),e("h3",[t._v("概要")]),t._v(" "),t._m(0),t._v(" "),e("h3",[t._v("設定方法")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),e("h2",[t._v("Content Security Policy (CSP)")]),t._v(" "),e("h3",[t._v("概要")]),t._v(" "),t._m(4),t._v(" "),e("h3",[t._v("設定方法")]),t._v(" "),e("table",[t._m(5),t._v(" "),e("tbody",[t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Nginx")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("add_header Content-Security-Policy “"),e("policy",[t._v("”;")])],1)]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Apache")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Header always set Content-Security-Policy “"),e("policy",[t._v("”")])],1)])])]),t._v(" "),e("p",[t._v("参照：")]),t._v(" "),t._m(10),t._v(" "),e("h2",[t._v("HTTP Strict Transport Security (HSTS)")]),t._v(" "),e("h3",[t._v("概要")]),t._v(" "),t._m(11),t._v(" "),e("h3",[t._v("設定方法")]),t._v(" "),t._m(12),t._v(" "),e("h2",[t._v("HTTP Public Key Pinning (HPKP)")]),t._v(" "),e("h3",[t._v("概要")]),t._v(" "),t._m(13),t._v(" "),e("h3",[t._v("設定方法")]),t._v(" "),e("p",[t._v("設定を推奨しない\n参照：https://blog.qualys.com/ssllabs/2016/09/06/is-http-public-key-pinning-dead")]),t._v(" "),e("h2",[t._v("X-Frame-Options")]),t._v(" "),e("h3",[t._v("概要")]),t._v(" "),t._m(14),t._v(" "),e("h3",[t._v("設定方法")]),t._v(" "),t._m(15),t._v(" "),e("h2",[t._v("X-Content-Type-Options")]),t._v(" "),e("h3",[t._v("概要")]),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),e("h3",[t._v("設定方法")]),t._v(" "),t._m(18),t._v(" "),e("h2",[t._v("Referrer-Policy")]),t._v(" "),e("h3",[t._v("概要")]),t._v(" "),t._m(19),t._v(" "),e("h3",[t._v("設定方法")]),t._v(" "),t._m(20),t._v(" "),e("h2",[t._v("参照")]),t._v(" "),t._m(21)])},staticRenderFns:[function(){var t=this.$createElement,n=this._self._c||t;return n("pre",{staticClass:"language-sh"},[n("code",{pre:!0,attrs:{class:"language-sh"}},[this._v("X-XSS-Protection: 0; \nX-XSS-Protection: 1; \nX-XSS-Protection: 1; mode=block\n")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("pre",{staticClass:"language-sh"},[n("code",{pre:!0,attrs:{class:"language-sh"}},[this._v("X-XSS-Protection: 1; mode=block\n")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("理由は"),n("a",{attrs:{href:"https://blog.innerht.ml/the-misunderstood-x-xss-protection/"}},[this._v("こちら")]),this._v("ご覧ください")])])},function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("platform")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("どう設定するの")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Rails4,5")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("設定不要。(デフォルト有効）")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Django")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("SECURE_BROWSER_XSS_FILTER = True")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Express.js")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Helmet")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Go")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("unrolled/secure")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Nginx")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("add_header: X-XSS-Protection “1; mode=block”;")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Apache")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Header always set X-XSS-Protection “1; mode=block”")])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("pre",{staticClass:"language-sh"},[n("code",{pre:!0,attrs:{class:"language-sh"}},[this._v("Content-Security-Policy: <policy>\n")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[this._v("platform")]),this._v(" "),n("th",{staticStyle:{"text-align":"left"}},[this._v("どう設定するの")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("tr",[n("td",{staticStyle:{"text-align":"left"}},[this._v("Rails4,5")]),this._v(" "),n("td",{staticStyle:{"text-align":"left"}},[this._v("secureheaders")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("tr",[n("td",{staticStyle:{"text-align":"left"}},[this._v("Django")]),this._v(" "),n("td",{staticStyle:{"text-align":"left"}},[this._v("django-csp")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("tr",[n("td",{staticStyle:{"text-align":"left"}},[this._v("Express.js")]),this._v(" "),n("td",{staticStyle:{"text-align":"left"}},[this._v("helmet/csp")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("tr",[n("td",{staticStyle:{"text-align":"left"}},[this._v("Go")]),this._v(" "),n("td",{staticStyle:{"text-align":"left"}},[this._v("unrolled/secure")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy")]),this._v(" "),n("li",[this._v("https://csp.withgoogle.com/docs/adopting-csp.html")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("pre",{staticClass:"language-sh"},[n("code",{pre:!0,attrs:{class:"language-sh"}},[this._v("Strict-Transport-Security: max-age=<expire-time>\nStrict-Transport-Security: max-age=<expire-time>; includeSubDomains\nStrict-Transport-Security: max-age=<expire-time>; preload\n")])])},function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("platform")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("どう設定するの")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Rails 4")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("config.force_ssl = true; config.ssl_options = { hsts: { subdomains: true } }")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Rails 5")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("config.force_ssl = true")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Django")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("SECURE_HSTS_SECONDS = 31536000; SECURE_HSTS_INCLUDE_SUBDOMAINS = True")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Express.js")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("helmet")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Go")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("unrolled/secure")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Nginx")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("add_header Strict-Transport-Security “max-age=31536000; includeSubdomains; “;")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Apache")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Header always set Strict-Transport-Security “max-age=31536000; includeSubdomains;")])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("pre",{staticClass:"language-sh"},[n("code",{pre:!0,attrs:{class:"language-sh"}},[this._v("Public-Key-Pins: pin-sha256=<base64==>; max-age=<expireTime>;\nPublic-Key-Pins: pin-sha256=<base64==>; max-age=<expireTime>; includeSubDomains\nPublic-Key-Pins: pin-sha256=<base64==>; max-age=<expireTime>; report-uri=<reportURI>\n")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("pre",{staticClass:"language-sh"},[n("code",{pre:!0,attrs:{class:"language-sh"}},[this._v("X-Frame-Options: DENY\nX-Frame-Options: SAMEORIGIN\nX-Frame-Options: ALLOW-FROM https://example.com/\n")])])},function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("platform")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("どう設定するの")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Rails4,5")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("config.action_dispatch.default_headers[‘X-Frame-Options’] = “DENY”")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Django")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("X_FRAME_OPTIONS = ‘DENY’")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Express.js")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("helmet")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Go")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("unrolled/secure")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Nginx")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("add_header X-Frame-Options “deny”;")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Apache")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Header always set X-Frame-Options “deny”")])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("pre",{staticClass:"language-sh"},[n("code",{pre:!0,attrs:{class:"language-sh"}},[this._v("X-Content-Type-Options: nosniff;\n")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("strong",[this._v("MIME sniffing")]),this._v("を防ぐヘッダ")])},function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("platform")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("どう設定するの")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Rails4,5")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("デフォルト有効")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Django")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("SECURE_CONTENT_TYPE_NOSNIFF = True")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Express.js")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("helmet")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Go")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("unrolled/secure")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Nginx")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("add_header X-Content-Type-Options nosniff;")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Apache")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Header always set X-Content-Type-Options nosniff")])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("pre",{staticClass:"language-sh"},[n("code",{pre:!0,attrs:{class:"language-sh"}},[this._v('Referrer-Policy: "no-referrer"\nReferrer-Policy: "no-referrer-when-downgrade"\nReferrer-Policy: "origin"\nReferrer-Policy: "origin-when-cross-origin"\nReferrer-Policy: "same-origin"\nReferrer-Policy: "strict-origin"\nReferrer-Policy: "strict-origin-when-cross-origin"\nReferrer-Policy: "unsafe-url"\n')])])},function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("platform")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("どう設定するの")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Rails4,5")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("secureheaders")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Django")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Custom middleware")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Express.js")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("helmet")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Go")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Custom middleware")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Nginx")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("add_header Referrer-Policy “no-referrer”;")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Apache")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Header always set Referrer-Policy “no-referrer”")])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy")]),this._v(" "),n("li",[this._v("https://techtalk.vn/tat-ca-nhung-thu-ban-can-biet-ve-http-security-headers.html")])])}]};t.exports={attributes:{title:"[Security]HTTP Security Headers",date:"2017-10-13T11:02:05.000Z",thumbnail:"posts/apache.jpg",draft:!1,tags:["security","apache"]},html:'<h1>All about Apache HTTP Security Header</h1>\n<h2>X-XSS-Protection</h2>\n<h3>概要</h3>\n<pre class="language-sh"><code class="language-sh">X-XSS-Protection: 0; \nX-XSS-Protection: 1; \nX-XSS-Protection: 1; mode=block\n</code></pre>\n<h3>設定方法</h3>\n<pre class="language-sh"><code class="language-sh">X-XSS-Protection: 1; mode=block\n</code></pre>\n<ul>\n<li>理由は<a href="https://blog.innerht.ml/the-misunderstood-x-xss-protection/">こちら</a>ご覧ください</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">platform</th>\n<th style="text-align:left">どう設定するの</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">Rails4,5</td>\n<td style="text-align:left">設定不要。(デフォルト有効）</td>\n</tr>\n<tr>\n<td style="text-align:left">Django</td>\n<td style="text-align:left">SECURE_BROWSER_XSS_FILTER = True</td>\n</tr>\n<tr>\n<td style="text-align:left">Express.js</td>\n<td style="text-align:left">Helmet</td>\n</tr>\n<tr>\n<td style="text-align:left">Go</td>\n<td style="text-align:left">unrolled/secure</td>\n</tr>\n<tr>\n<td style="text-align:left">Nginx</td>\n<td style="text-align:left">add_header: X-XSS-Protection “1; mode=block”;</td>\n</tr>\n<tr>\n<td style="text-align:left">Apache</td>\n<td style="text-align:left">Header always set X-XSS-Protection “1; mode=block”</td>\n</tr>\n</tbody>\n</table>\n<h2>Content Security Policy (CSP)</h2>\n<h3>概要</h3>\n<pre class="language-sh"><code class="language-sh">Content-Security-Policy: &lt;policy&gt;\n</code></pre>\n<h3>設定方法</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">platform</th>\n<th style="text-align:left">どう設定するの</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">Rails4,5</td>\n<td style="text-align:left">secureheaders</td>\n</tr>\n<tr>\n<td style="text-align:left">Django</td>\n<td style="text-align:left">django-csp</td>\n</tr>\n<tr>\n<td style="text-align:left">Express.js</td>\n<td style="text-align:left">helmet/csp</td>\n</tr>\n<tr>\n<td style="text-align:left">Go</td>\n<td style="text-align:left">unrolled/secure</td>\n</tr>\n<tr>\n<td style="text-align:left">Nginx</td>\n<td style="text-align:left">add_header Content-Security-Policy “<policy>”;</td>\n</tr>\n<tr>\n<td style="text-align:left">Apache</td>\n<td style="text-align:left">Header always set Content-Security-Policy “<policy>”</td>\n</tr>\n</tbody>\n</table>\n<p>参照：</p>\n<ul>\n<li>https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy</li>\n<li>https://csp.withgoogle.com/docs/adopting-csp.html</li>\n</ul>\n<h2>HTTP Strict Transport Security (HSTS)</h2>\n<h3>概要</h3>\n<pre class="language-sh"><code class="language-sh">Strict-Transport-Security: max-age=&lt;expire-time&gt;\nStrict-Transport-Security: max-age=&lt;expire-time&gt;; includeSubDomains\nStrict-Transport-Security: max-age=&lt;expire-time&gt;; preload\n</code></pre>\n<h3>設定方法</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">platform</th>\n<th style="text-align:left">どう設定するの</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">Rails 4</td>\n<td style="text-align:left">config.force_ssl = true; config.ssl_options = { hsts: { subdomains: true } }</td>\n</tr>\n<tr>\n<td style="text-align:left">Rails 5</td>\n<td style="text-align:left">config.force_ssl = true</td>\n</tr>\n<tr>\n<td style="text-align:left">Django</td>\n<td style="text-align:left">SECURE_HSTS_SECONDS = 31536000; SECURE_HSTS_INCLUDE_SUBDOMAINS = True</td>\n</tr>\n<tr>\n<td style="text-align:left">Express.js</td>\n<td style="text-align:left">helmet</td>\n</tr>\n<tr>\n<td style="text-align:left">Go</td>\n<td style="text-align:left">unrolled/secure</td>\n</tr>\n<tr>\n<td style="text-align:left">Nginx</td>\n<td style="text-align:left">add_header Strict-Transport-Security “max-age=31536000; includeSubdomains; “;</td>\n</tr>\n<tr>\n<td style="text-align:left">Apache</td>\n<td style="text-align:left">Header always set Strict-Transport-Security “max-age=31536000; includeSubdomains;</td>\n</tr>\n</tbody>\n</table>\n<h2>HTTP Public Key Pinning (HPKP)</h2>\n<h3>概要</h3>\n<pre class="language-sh"><code class="language-sh">Public-Key-Pins: pin-sha256=&lt;base64==&gt;; max-age=&lt;expireTime&gt;;\nPublic-Key-Pins: pin-sha256=&lt;base64==&gt;; max-age=&lt;expireTime&gt;; includeSubDomains\nPublic-Key-Pins: pin-sha256=&lt;base64==&gt;; max-age=&lt;expireTime&gt;; report-uri=&lt;reportURI&gt;\n</code></pre>\n<h3>設定方法</h3>\n<p>設定を推奨しない\n参照：https://blog.qualys.com/ssllabs/2016/09/06/is-http-public-key-pinning-dead</p>\n<h2>X-Frame-Options</h2>\n<h3>概要</h3>\n<pre class="language-sh"><code class="language-sh">X-Frame-Options: DENY\nX-Frame-Options: SAMEORIGIN\nX-Frame-Options: ALLOW-FROM https://example.com/\n</code></pre>\n<h3>設定方法</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">platform</th>\n<th style="text-align:left">どう設定するの</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">Rails4,5</td>\n<td style="text-align:left">config.action_dispatch.default_headers[‘X-Frame-Options’] = “DENY”</td>\n</tr>\n<tr>\n<td style="text-align:left">Django</td>\n<td style="text-align:left">X_FRAME_OPTIONS = ‘DENY’</td>\n</tr>\n<tr>\n<td style="text-align:left">Express.js</td>\n<td style="text-align:left">helmet</td>\n</tr>\n<tr>\n<td style="text-align:left">Go</td>\n<td style="text-align:left">unrolled/secure</td>\n</tr>\n<tr>\n<td style="text-align:left">Nginx</td>\n<td style="text-align:left">add_header X-Frame-Options “deny”;</td>\n</tr>\n<tr>\n<td style="text-align:left">Apache</td>\n<td style="text-align:left">Header always set X-Frame-Options “deny”</td>\n</tr>\n</tbody>\n</table>\n<h2>X-Content-Type-Options</h2>\n<h3>概要</h3>\n<pre class="language-sh"><code class="language-sh">X-Content-Type-Options: nosniff;\n</code></pre>\n<p><strong>MIME sniffing</strong>を防ぐヘッダ</p>\n<h3>設定方法</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">platform</th>\n<th style="text-align:left">どう設定するの</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">Rails4,5</td>\n<td style="text-align:left">デフォルト有効</td>\n</tr>\n<tr>\n<td style="text-align:left">Django</td>\n<td style="text-align:left">SECURE_CONTENT_TYPE_NOSNIFF = True</td>\n</tr>\n<tr>\n<td style="text-align:left">Express.js</td>\n<td style="text-align:left">helmet</td>\n</tr>\n<tr>\n<td style="text-align:left">Go</td>\n<td style="text-align:left">unrolled/secure</td>\n</tr>\n<tr>\n<td style="text-align:left">Nginx</td>\n<td style="text-align:left">add_header X-Content-Type-Options nosniff;</td>\n</tr>\n<tr>\n<td style="text-align:left">Apache</td>\n<td style="text-align:left">Header always set X-Content-Type-Options nosniff</td>\n</tr>\n</tbody>\n</table>\n<h2>Referrer-Policy</h2>\n<h3>概要</h3>\n<pre class="language-sh"><code class="language-sh">Referrer-Policy: &quot;no-referrer&quot;\nReferrer-Policy: &quot;no-referrer-when-downgrade&quot;\nReferrer-Policy: &quot;origin&quot;\nReferrer-Policy: &quot;origin-when-cross-origin&quot;\nReferrer-Policy: &quot;same-origin&quot;\nReferrer-Policy: &quot;strict-origin&quot;\nReferrer-Policy: &quot;strict-origin-when-cross-origin&quot;\nReferrer-Policy: &quot;unsafe-url&quot;\n</code></pre>\n<h3>設定方法</h3>\n<table>\n<thead>\n<tr>\n<th style="text-align:left">platform</th>\n<th style="text-align:left">どう設定するの</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align:left">Rails4,5</td>\n<td style="text-align:left">secureheaders</td>\n</tr>\n<tr>\n<td style="text-align:left">Django</td>\n<td style="text-align:left">Custom middleware</td>\n</tr>\n<tr>\n<td style="text-align:left">Express.js</td>\n<td style="text-align:left">helmet</td>\n</tr>\n<tr>\n<td style="text-align:left">Go</td>\n<td style="text-align:left">Custom middleware</td>\n</tr>\n<tr>\n<td style="text-align:left">Nginx</td>\n<td style="text-align:left">add_header Referrer-Policy “no-referrer”;</td>\n</tr>\n<tr>\n<td style="text-align:left">Apache</td>\n<td style="text-align:left">Header always set Referrer-Policy “no-referrer”</td>\n</tr>\n</tbody>\n</table>\n<h2>参照</h2>\n<ul>\n<li>https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy</li>\n<li>https://techtalk.vn/tat-ca-nhung-thu-ban-can-biet-ve-http-security-headers.html</li>\n</ul>\n',meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/apache-security-header/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},342:function(t,n){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("h2",[t._v("流れ")]),t._v(" "),e("ul",[e("li",[e("ol",[e("li",[t._v("CSRを作成する")])])]),t._v(" "),e("li",[e("ol",{attrs:{start:"2"}},[e("li",[t._v("証明書発行")])])]),t._v(" "),e("li",[e("ol",{attrs:{start:"3"}},[e("li",[t._v("サーバー設定")])])])]),t._v(" "),e("h3",[t._v("1. CSRを作成する")]),t._v(" "),e("p",[t._v("CSR (Certificate Signing Request)は証明書発行依頼書と呼ばれ、CA(Certificate authority)へ提出するもの。\n作成時に以下の情報が重要出そうだ。")]),t._v(" "),e("ul",[e("li",[t._v("Common Name (eg, your name or your server's hostname)")]),t._v(" "),e("li",[t._v("Domain name or server's public IP address")])]),t._v(" "),e("h4",[t._v("1.1. Private Key(機密鍵)発行")]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("openssl genrsa -out /path/to/.key 2048\n")])]),t._v(" "),e("h4",[t._v("1.2. CSR発行 (Certificate Signing Request)")]),t._v(" "),e("pre",{staticClass:"language-shell"},[e("code",{pre:!0,attrs:{class:"language-shell"}},[t._v("openssl req -new -key /path/to/.key -out /path/to/.csr\n")])]),t._v(" "),e("h4",[t._v("1.3. Private Keyからpassphraseを排除（無効）")]),t._v(" "),e("p",[e("code",{pre:!0},[t._v("Passphrase")]),t._v("を有効にしていると、サーバー再起動した際、"),e("code",{pre:!0},[t._v("Private Key")]),t._v("を認証する為、"),e("code",{pre:!0},[t._v("Passphrase")]),t._v("が求められるので、入力完了するまで、\b"),e("code",{pre:!0},[t._v("Website")]),t._v("をアクセスできないことがある。")]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("cp server.key server.key.org\nopenssl rsa -in server.key.org -out server.key\n")])]),t._v(" "),e("h3",[t._v("2. 証明書取得")]),t._v(" "),e("p",[t._v("実際はCAに発行してもらうが、テスト時は自己署名証明書を使用する。\nこのテストのようの証明書は"),e("code",{pre:!0},[t._v("self-signed certificate")]),t._v("と呼ばれる。")]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt\n")])]),t._v(" "),e("p",[e("strong",[t._v("👉"),e("code",{pre:!0},[t._v("self-signed certificate")]),t._v("を使用する場合、以下のコマンドでCSR発行せずに、直接証明書を生成することができる")])]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/apache-selfsigned.key -out /etc/ssl/certs/apache-selfsigned.crt\n")])]),t._v(" "),e("ul",[e("li",[t._v("req: X509によりCSR作成")]),t._v(" "),e("li",[t._v("x509: "),e("code",{pre:!0},[t._v("self-signed")]),t._v("認証発行する指示")]),t._v(" "),e("li",[t._v("nodes: "),e("code",{pre:!0},[t._v("passphrase")]),t._v("を使用しない")]),t._v(" "),e("li",[t._v("days 365: 有効期限（１年）")]),t._v(" "),e("li",[t._v("newkey rsa:2048長ビットのkeyと証明書同時に発行。(rsa key with 2048 bits long)")]),t._v(" "),e("li",[t._v("keyout: private keyの作成場所")]),t._v(" "),e("li",[t._v("out: 証明書の置く場所")])]),t._v(" "),e("h3",[t._v("3. サーバー設定")]),t._v(" "),e("h4",[t._v("3.1. 設定ファイル修正")]),t._v(" "),e("p",[e("strong",[t._v("/etc/httpd/conf.d/ssl.conf")])]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("# プロトコル\nSSLProtocol -All +TLSv1 +TLSv1.1 +TLSv1.2\n\n# 証明書指\nSSLCertificateFile path/to/.crt\n\n# 鍵ファイル指定\nSSLCertificateKeyFile /path/to/.key\n")])]),t._v(" "),e("h4",[t._v("3.2. firewall 設定")]),t._v(" "),e("p",[e("code",{pre:!0},[t._v("https")]),t._v("アクセスを許可する")]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("firewall-cmd --add-service=https --permanent\nfirewall-cmd --reload\n")])])])}]};t.exports={attributes:{title:"Linuxにサーバーを構築してみる",description:"LinuxにApache上の自己証明HTTPSサーバー構築したメモです。",thumbnail:"posts/https.jpg",date:"2017-11-02T13:29:47.000Z",tags:["linux","apache","https"]},html:'<h2>流れ</h2>\n<ul>\n<li>\n<ol>\n<li>CSRを作成する</li>\n</ol>\n</li>\n<li>\n<ol start="2">\n<li>証明書発行</li>\n</ol>\n</li>\n<li>\n<ol start="3">\n<li>サーバー設定</li>\n</ol>\n</li>\n</ul>\n<h3>1. CSRを作成する</h3>\n<p>CSR (Certificate Signing Request)は証明書発行依頼書と呼ばれ、CA(Certificate authority)へ提出するもの。\n作成時に以下の情報が重要出そうだ。</p>\n<ul>\n<li>Common Name (eg, your name or your server\'s hostname)</li>\n<li>Domain name or server\'s public IP address</li>\n</ul>\n<h4>1.1. Private Key(機密鍵)発行</h4>\n<pre class="language-sh"><code class="language-sh">openssl genrsa -out /path/to/.key 2048\n</code></pre>\n<h4>1.2. CSR発行 (Certificate Signing Request)</h4>\n<pre class="language-shell"><code class="language-shell">openssl req -new -key /path/to/.key -out /path/to/.csr\n</code></pre>\n<h4>1.3. Private Keyからpassphraseを排除（無効）</h4>\n<p><code>Passphrase</code>を有効にしていると、サーバー再起動した際、<code>Private Key</code>を認証する為、<code>Passphrase</code>が求められるので、入力完了するまで、\b<code>Website</code>をアクセスできないことがある。</p>\n<pre class="language-sh"><code class="language-sh">cp server.key server.key.org\nopenssl rsa -in server.key.org -out server.key\n</code></pre>\n<h3>2. 証明書取得</h3>\n<p>実際はCAに発行してもらうが、テスト時は自己署名証明書を使用する。\nこのテストのようの証明書は<code>self-signed certificate</code>と呼ばれる。</p>\n<pre class="language-sh"><code class="language-sh">openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt\n</code></pre>\n<p><strong>👉<code>self-signed certificate</code>を使用する場合、以下のコマンドでCSR発行せずに、直接証明書を生成することができる</strong></p>\n<pre class="language-sh"><code class="language-sh">sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/apache-selfsigned.key -out /etc/ssl/certs/apache-selfsigned.crt\n</code></pre>\n<ul>\n<li>req: X509によりCSR作成</li>\n<li>x509: <code>self-signed</code>認証発行する指示</li>\n<li>nodes: <code>passphrase</code>を使用しない</li>\n<li>days 365: 有効期限（１年）</li>\n<li>newkey rsa:2048長ビットのkeyと証明書同時に発行。(rsa key with 2048 bits long)</li>\n<li>keyout: private keyの作成場所</li>\n<li>out: 証明書の置く場所</li>\n</ul>\n<h3>3. サーバー設定</h3>\n<h4>3.1. 設定ファイル修正</h4>\n<p><strong>/etc/httpd/conf.d/ssl.conf</strong></p>\n<pre class="language-sh"><code class="language-sh"># プロトコル\nSSLProtocol -All +TLSv1 +TLSv1.1 +TLSv1.2\n\n# 証明書指\nSSLCertificateFile path/to/.crt\n\n# 鍵ファイル指定\nSSLCertificateKeyFile /path/to/.key\n</code></pre>\n<h4>3.2. firewall 設定</h4>\n<p><code>https</code>アクセスを許可する</p>\n<pre class="language-sh"><code class="language-sh">firewall-cmd --add-service=https --permanent\nfirewall-cmd --reload\n</code></pre>\n',meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/centos-apache-https-server/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},343:function(t,n){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("p",[t._v("Docker上開発環境を構築してみた")]),t._v(" "),e("ul",[e("li",[t._v("Stack: php, Laravel, nginx, postgres")])]),t._v(" "),e("h2",[t._v("各環境ファイル作成")]),t._v(" "),e("p",[e("strong",[t._v("docker-compose.yml")])]),t._v(" "),e("pre",{staticClass:"language-yaml"},[e("code",{pre:!0,attrs:{class:"language-yaml"}},[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./nginx\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 8080"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80 ")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./nginx/nginx.conf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/nginx/conf.d/default.conf\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./src"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/www/app\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" web\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./src\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./src"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/www/app\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" db\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("db")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'postgres:9.3'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5432:5432"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env_file")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./data/env_file\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - ./data/postgres:/var/lib/postgresql/data")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" pgdata"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/postgresql/data\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# volumes:")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   pgdata:")]),t._v("\n")])]),t._v(" "),e("p",[e("strong",[t._v("data/env_file")])]),t._v(" "),e("pre",{staticClass:"language-dotenv"},[e("code",{pre:!0,attrs:{class:"language-dotenv"}},[t._v("POSTGRES_USER=postgres\nPOSTGRES_DB=my_db\nPOSTGRES_PASSWORD=postgres\n")])]),t._v(" "),e("p",[e("strong",[t._v("nginx/nginx.conf")])]),t._v(" "),e("pre",{staticClass:"language-yaml"},[e("code",{pre:!0,attrs:{class:"language-yaml"}},[t._v("server "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen 80;\n    server_name app;\n\n    root  /var/www/app;\n    index index.php index.html;\n\n    access_log /var/log/nginx/access.log;\n    error_log  /var/log/nginx/error.log;\n\n    location / "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        try_files $uri $uri/ /index.php$is_args$args;\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    location ~ \\.php$ "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        fastcgi_pass web"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("9000;\n        fastcgi_index index.php;    \n        fastcgi_param SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n        include       fastcgi_params;\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("h2",[t._v("起動")]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("docker-compose up -d\n")])]),t._v(" "),e("p",[t._v("ここで"),e("strong",[t._v("web")]),t._v(", "),e("strong",[t._v("nginx")]),t._v(", "),e("strong",[t._v("db")]),t._v("の３サービスが立ち上がって、"),e("strong",[t._v("localhost:8080")]),t._v("アクセスできる")]),t._v(" "),e("h2",[t._v("ファイル変更して、際ビルドしたい場合")]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("docker-compose up -d --build\n")])]),t._v(" "),e("h2",[t._v("解説")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Dockerはデータを持たない為、再起動するとデータ損失")])]),t._v(" "),e("li",[e("p",[t._v("データ損失を防ぐ為、"),e("strong",[t._v("volumes")]),t._v("を使用する")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("postgres")]),t._v("イメージは"),e("strong",[t._v("env_file")]),t._v("の情報でデータベースを作成する")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("postgres")]),t._v("のデータを"),e("strong",[t._v("volumes")]),t._v("に格納すれば、データ維持できる")])])]),t._v(" "),e("pre",{staticClass:"language-yaml"},[e("code",{pre:!0,attrs:{class:"language-yaml"}},[t._v("    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./data/postgres"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/postgresql/data\n")])]),t._v(" "),e("ul",[e("li",[t._v("Windows環境ではなんだかこのような"),e("strong",[t._v("volumes")]),t._v("マウントしかたは上手く行きそうにないのでで、ネームvolumesに修正した")])]),t._v(" "),e("blockquote",[e("p",[t._v('FATAL: data directory "/var/lib/postgresql/data" has wrong ownership')])]),t._v(" "),e("pre",{staticClass:"language-yaml"},[e("code",{pre:!0,attrs:{class:"language-yaml"}},[t._v("    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" pgdata"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/postgresql/data\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pgdata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("docker-compose up -d")]),t._v("を実行すると、以下が起こる\n"),e("ul",[e("li",[e("strong",[t._v("myapp_default")]),t._v("ネットワークが作られる。")]),t._v(" "),e("li",[e("strong",[t._v("web")]),t._v(", "),e("strong",[t._v("nginx")]),t._v(", "),e("strong",[t._v("db")]),t._v("の３サービスが作成され、"),e("strong",[t._v("myapp_default")]),t._v("にジョイン")]),t._v(" "),e("li",[e("strong",[t._v("myapp_default")]),t._v("ネットワーク環境下で、名前でアクセス可能。"),e("br"),t._v("\n例"),e("strong",[t._v("web")]),t._v("から"),e("strong",[t._v("db")]),t._v("でデータベースをアクセス、"),e("br"),t._v(" "),e("strong",[t._v("nginx")]),t._v("で"),e("strong",[t._v("web")]),t._v("を使って、"),e("strong",[t._v("web")]),t._v("をアクセス\\")])])])])])}]};t.exports={attributes:{title:"[Docker]メモ",date:"2018-04-30T22:29:03.000Z",thumbnail:"posts/docker.png",description:"docker-composeでPHP開発環境を構築",tags:["docker"]},html:'<p>Docker上開発環境を構築してみた</p>\n<ul>\n<li>Stack: php, Laravel, nginx, postgres</li>\n</ul>\n<h2>各環境ファイル作成</h2>\n<p><strong>docker-compose.yml</strong></p>\n<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3\'</span>\n<span class="token key atrule">services</span><span class="token punctuation">:</span> \n  <span class="token key atrule">nginx</span><span class="token punctuation">:</span> \n    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./nginx\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span> \n      <span class="token punctuation">-</span> 8080<span class="token punctuation">:</span><span class="token number">80 </span>\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span> \n      <span class="token punctuation">-</span> ./nginx/nginx.conf<span class="token punctuation">:</span>/etc/nginx/conf.d/default.conf\n      <span class="token punctuation">-</span> ./src<span class="token punctuation">:</span>/var/www/app\n    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span> \n      <span class="token punctuation">-</span> web\n  <span class="token key atrule">web</span><span class="token punctuation">:</span>\n    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./src\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span> \n      <span class="token punctuation">-</span> ./src<span class="token punctuation">:</span>/var/www/app\n    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span> \n      <span class="token punctuation">-</span> db\n  <span class="token key atrule">db</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">\'postgres:9.3\'</span>\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">"5432:5432"</span>\n    <span class="token key atrule">env_file</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> ./data/env_file\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token comment"># - ./data/postgres:/var/lib/postgresql/data</span>\n      <span class="token punctuation">-</span> pgdata<span class="token punctuation">:</span>/var/lib/postgresql/data\n\n<span class="token comment"># volumes:</span>\n<span class="token comment">#   pgdata:</span>\n</code></pre>\n<p><strong>data/env_file</strong></p>\n<pre class="language-dotenv"><code class="language-dotenv">POSTGRES_USER=postgres\nPOSTGRES_DB=my_db\nPOSTGRES_PASSWORD=postgres\n</code></pre>\n<p><strong>nginx/nginx.conf</strong></p>\n<pre class="language-yaml"><code class="language-yaml">server <span class="token punctuation">{</span>\n    listen 80;\n    server_name app;\n\n    root  /var/www/app;\n    index index.php index.html;\n\n    access_log /var/log/nginx/access.log;\n    error_log  /var/log/nginx/error.log;\n\n    location / <span class="token punctuation">{</span>\n        try_files $uri $uri/ /index.php$is_args$args;\n    <span class="token punctuation">}</span>\n\n    location ~ \\.php$ <span class="token punctuation">{</span>\n        fastcgi_pass web<span class="token punctuation">:</span>9000;\n        fastcgi_index index.php;    \n        fastcgi_param SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n        include       fastcgi_params;\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<h2>起動</h2>\n<pre class="language-sh"><code class="language-sh">docker-compose up -d\n</code></pre>\n<p>ここで<strong>web</strong>, <strong>nginx</strong>, <strong>db</strong>の３サービスが立ち上がって、<strong>localhost:8080</strong>アクセスできる</p>\n<h2>ファイル変更して、際ビルドしたい場合</h2>\n<pre class="language-sh"><code class="language-sh">docker-compose up -d --build\n</code></pre>\n<h2>解説</h2>\n<ul>\n<li>\n<p>Dockerはデータを持たない為、再起動するとデータ損失</p>\n</li>\n<li>\n<p>データ損失を防ぐ為、<strong>volumes</strong>を使用する</p>\n</li>\n<li>\n<p><strong>postgres</strong>イメージは<strong>env_file</strong>の情報でデータベースを作成する</p>\n</li>\n<li>\n<p><strong>postgres</strong>のデータを<strong>volumes</strong>に格納すれば、データ維持できる</p>\n</li>\n</ul>\n<pre class="language-yaml"><code class="language-yaml">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> ./data/postgres<span class="token punctuation">:</span>/var/lib/postgresql/data\n</code></pre>\n<ul>\n<li>Windows環境ではなんだかこのような<strong>volumes</strong>マウントしかたは上手く行きそうにないのでで、ネームvolumesに修正した</li>\n</ul>\n<blockquote>\n<p>FATAL: data directory &quot;/var/lib/postgresql/data&quot; has wrong ownership</p>\n</blockquote>\n<pre class="language-yaml"><code class="language-yaml">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> pgdata<span class="token punctuation">:</span>/var/lib/postgresql/data\n<span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n  <span class="token key atrule">pgdata</span><span class="token punctuation">:</span>\n</code></pre>\n<ul>\n<li><strong>docker-compose up -d</strong>を実行すると、以下が起こる\n<ul>\n<li><strong>myapp_default</strong>ネットワークが作られる。</li>\n<li><strong>web</strong>, <strong>nginx</strong>, <strong>db</strong>の３サービスが作成され、<strong>myapp_default</strong>にジョイン</li>\n<li><strong>myapp_default</strong>ネットワーク環境下で、名前でアクセス可能。<br>\n例<strong>web</strong>から<strong>db</strong>でデータベースをアクセス、<br>\n<strong>nginx</strong>で<strong>web</strong>を使って、<strong>web</strong>をアクセス\\</li>\n</ul>\n</li>\n</ul>\n',meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/docker-memo/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},344:function(t,n){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("p",[e("img",{attrs:{src:"https://i.stack.imgur.com/WRNrD.png",alt:"Image"}}),t._v("\nSource: "),e("a",{attrs:{href:"https://stackoverflow.com/questions/470523/how-does-ssl-really-work"}},[t._v("Source: StackOverFlow")])]),t._v(" "),e("h2",[t._v("日本語")]),t._v(" "),e("ol",[e("li",[t._v("ブラウザは"),e("code",{pre:!0},[t._v("https://payment.com")]),t._v("に接続を成立する。")]),t._v(" "),e("li",[e("code",{pre:!0},[t._v("https://payment.com")]),t._v("のサーバーはブラウザに証明書を送る。この証明書は公開鍵が含まれる。")]),t._v(" "),e("li",[t._v("ブラウザは"),e("code",{pre:!0},[t._v("https://payment.com")]),t._v("の証明書は有効であるものを確認する。※")]),t._v(" "),e("li",[t._v("ステップ３を通過したら、ブラウザは新しい鍵（"),e("code",{pre:!0},[t._v("K")]),t._v("と呼ばれる）を生成し、"),e("code",{pre:!0},[t._v("https://payment.com")]),t._v("の公開鍵を使って暗号化してから"),e("code",{pre:!0},[t._v("https://payment.com")]),t._v("に送信する")]),t._v(" "),e("li",[e("code",{pre:!0},[t._v("https://payment.com")]),t._v("は機密鍵で"),e("code",{pre:!0},[t._v("K")]),t._v("を複合化する")]),t._v(" "),e("li",[t._v("ここからブラウザとサーバは"),e("code",{pre:!0},[t._v("K")]),t._v("でデータ通信を行う。")])]),t._v(" "),e("h2",[t._v("Tiếng Việt.")]),t._v(" "),e("ol",[e("li",[t._v("Browser sẽ truy cập 1 trang web https. Ở đây là https://payment.com")]),t._v(" "),e("li",[t._v("Server hay Load Balancer (LB) của payment.com sẽ trả về certificate để chứng thực rằng website user đang truy cập là website chính thức. Trong certificate là một public key PK, dùng để mã hóa K ở bước 4.")]),t._v(" "),e("li",[t._v("Browser sẽ kiểm chứng certificate (bằng cách chạy thuật toán kiểm tra chữ ký). Quá trình này giúp browser xác định https://payment.com là thật hay giả.")]),t._v(" "),e("li",[t._v("Sau khi kiểm chứng được certificate, browser sẽ tự sinh ra 1 khóa K. Khóa K sẽ được dùng để mã hóa tất cả các liên lạc giữa browser và payment.com sau này. Do quá trình mã hóa các gói tin dùng mã đối xứng, khóa K cần được gửi trở lại payment.com vì nếu không có K, server (LB) không thể nào giải mã được gói tin.")]),t._v(" "),e("li",[t._v("Khóa K được gửi trả lại cho payment.com. Phía payment.com sẽ dùng private key (được bảo vệ) để giải mã gói tin này và qua đó có được thông tin về K.")]),t._v(" "),e("li",[t._v("payment.com và browser dùng khóa K để mã hóa toàn bộ dữ liệu liên lạc sau này.")])]),t._v(" "),e("p",[t._v("Certificate là một khối dữ liệu bao gồm rất nhiều thông tin về payment.com. Các thông tin này bao gồm:")]),t._v(" "),e("ul",[e("li",[t._v("Tên domain")]),t._v(" "),e("li",[t._v("Tên công ty sở hữu")]),t._v(" "),e("li",[t._v("Thời gian certificate được cấp")]),t._v(" "),e("li",[t._v("Thời hạn certificate")]),t._v(" "),e("li",[t._v("Public key PK")])]),t._v(" "),e("h3",[t._v("Làm thế nào browser kiểm chứng được certificate ở bước 3")]),t._v(" "),e("p",[t._v("Bất cứ người nào đứng giữa browser và payment.com đều có thể làm giả certificate và public key. Bằng cách làm giả certificate, người đứng giữa có thể giả dạng payment.com. Bằng cách giả public key, người đứng giữa có thể dùng khóa private của mình để xem thông tin truyển tải giữa 2 bên. Vậy làm thế nào để ngăn chặn cách tấn công này. Cách giải quyết là: CA (Certificate Authority).")]),t._v(" "),e("h4",[t._v("CA là gì? Làm gì?")]),t._v(" "),e("p",[t._v("Trong thực tế, để chứng minh một ai đó trình độ đại học, trường đại học nơi người đó học sẽ cấp cho họ một tấm bằng. Do tấm bằng đó có thể bị làm giả, ta cần một đơn vị chứng minh đó là bằng thật. CA chính là người chứng minh certificate mà payment.com cung cấp là thật! CA bán dịch vụ chứng thực đó bằng cách ký chứng minh rằng certificate của payment.com là thật")]),t._v(" "),e("p",[t._v("Certificate chứng thực cho payment.com sẽ được CA ký bằng khóa bí mật của CA. Khóa này chỉ có CA biết và do vậy việc chữ ký là an toàn. payment.com sẽ gửi cho user certificate đã được ký bởi CA cùng với khóa công khai PK2 của khóa bí mật CA dùng để ký certificate. Browser sẽ tiến hành kiểm tra certificate này như bình thường dùng khóa công khai PK2 của CA.")]),t._v(" "),e("p",[t._v("Đến đây vấn đề chưa thực sự được giải quyết vì, khóa công khai của CA cũng hoàn toàn có thể bị làm giả và do vậy certificate hoàn toàn có thể là giả! Giống như thực tế người chứng minh cho tấm bằng đại học cũng có thể bị làm giả. Để chắc chắn việc này, ta có thể ký chứng thực certificate do CA ký là thật. Cách làm có thể hoàn toàn tương tự là dùng khóa bí mật nào đó và ký tiếp và đính kèm khóa công khai PK3 với certificate sau khi được ký. Cứ thế ta có một dãy các certificate và khóa công khai mà certificate sau chứng thực cho certificate trước. Do bản chất đệ quy, ta cần điểm dừng là một certificate mà ta hoàn toàn tin tưởng. Đến đây ta có khái niệm root certificate.")]),t._v(" "),e("h4",[t._v("Root certificate")]),t._v(" "),e("p",[t._v("Root certificate là certificate mà ta hoàn toàn tin tưởng. Khi có certificate này, ta có thể tin tưởng những certificate mà được chứng thực bởi certificate này là hoàn toàn hợp lệ (giống trong thực tế là cơ quan công chứng!). Mỗi OS và browser có một danh sách các certificate mà OS và browser đó tin tưởng.")]),t._v(" "),e("p",[t._v("Firefox tin tưởng các certificate có danh sách tại: https://wiki.mozilla.org/CA:IncludedCAs\nRHEL có danh sách các certificate tin tưởng tại: /etc/pki/tls/certs/")]),t._v(" "),e("p",[t._v("Do root certificate là certificate cuối cùng dùng để chứng thực các certificate trong chuỗi, khóa bí mật của certificate này cần được bảo vệ nghiêm ngặt. Bất cứ công ty cung cấp dịch vụ CA nào bị tấn công và bị mất khóa bí mật của root certificate đều rất nguy hiểm, bởi vì hackers có thể dùng khóa đó để ký certificate ở bước cuối cùng. Do browser và OS tin tưởng certificate này nên tất cả certificate, không nhất thiết do CA bị hack cung cấp, đều có thể bị làm giả. Các CA do vậy dùng rất nhiều công sức để bảo vệ thật kín đáo khóa bí mật này. Kinh doanh chứng thực CA là kinh doanh về mặt lòng tin, CA hứa sẽ đảm bảo tốt nhất khóa bí mật của họ và ta trả tiền để họ dùng khóa bí mật của họ ký.")]),t._v(" "),e("p",[t._v("Theo đồn đại của giang hồ, verisign dùng cửa lock dày và các tay súng chuyên nghiệp cùng hệ thống truy cập phức tạp để bảo vệ khóa bí mật này.")]),t._v(" "),e("h4",[t._v("Xem certificate chain trong thực tế")]),t._v(" "),e("p",[t._v("Đến đây ta chắc đã hiểu phần nào về cơ chế chứng thực cũng như cách hoạt động của HTTPS. Ta sẽ cùng xem chuỗi certificate trong thực tế.")]),t._v(" "),e("p",[t._v("Facebook certificate được ký bởi DigiCert High Assurance CA-3. Bản thân CA-3 được chứng thực bởi EV RootCA.")]),t._v(" "),e("h4",[t._v("Các vấn đề liên quan đến https / certificate")]),t._v(" "),e("p",[t._v("Nguyên tắc hoạt động là như vậy, trong thực tế để duy trì và vận hành một hệ thống https cần tốn khá nhiều công sức. Dưới đây là một số case-studies mình gặp trong quá trình vận hành một website. Qua một số case-studies này hy vọng bạn sẽ hiểu tầm quan trọng của mỗi sự kiện và ý nghĩa của nó.")]),t._v(" "),e("h5",[t._v("Heartbleed")]),t._v(" "),e("p",[t._v("Sự kiện heartbleed là sự kiện đình đám của năm 2014. Heartbleed là lỗi bảo mật nằm trong bộ thư viện OpenSSL, bộ thư viện chủ đạo xử lý mã hóa trên Linux. Các webserver đều được build sử dụng OpenSSL nếu muốn phục vụ https.")]),t._v(" "),e("p",[t._v("Heartbleed xảy ra khi openssl không kiểm tra độ dài trả về của một chuỗi ký tự và vô tình trả về thông tin nằm sau chuỗi ký tự này trên bộ nhớ. Vô tình phần bộ nhớ này bao gồm khóa bí mật được dùng để ký certificate ban đầu. Bằng cách hỏi máy chủ cho xem chìa khóa bí mật này, hacker có thể dùng nó để giải mã khóa mã hóa liên lạc ở bước 5 và do đó đọc được toàn bộ nội dung của phiên liên lạc.")]),t._v(" "),e("p",[t._v("Heartbleed nguy hiểm bởi việc tấn công này hoàn toàn không để lại dấu vết.")]),t._v(" "),e("p",[t._v("Các công ty cung cấp dịch vụ qua https đã phải xử lý vấn đề này bao gồm các bước sau:")]),t._v(" "),e("ul",[e("li",[t._v("Nâng cấp phiên bản openssl")]),t._v(" "),e("li",[t._v("Khởi động lại máy chủ web (apache, nginx)")]),t._v(" "),e("li",[t._v("Tạo một khóa bí mật mới, certificate mới và yêu cầu CAs ký lại")])]),t._v(" "),e("h5",[t._v("Diginostar")]),t._v(" "),e("p",[t._v("Diginostar là hãng CAs của Hà Lan bị hacker tấn công và lấy được khóa bí mật. Từ đó tất cả các root certificate của Diginostar đều bị xóa bỏ khỏi browser, do lo sợ hacker sẽ dùng khóa bí mật này làm giả certificate. Điều này dẫn đến sự phá sản của CA.")]),t._v(" "),e("p",[t._v("Qua đấy mới thấy việc bảo vệ khóa bí mật an toàn là vấn đề sống còn của các CAs.")]),t._v(" "),e("h5",[t._v("Superfish")]),t._v(" "),e("p",[t._v("Hãng máy tính Lenovo khi bán máy tính đã cài thêm một phần mềm hiển thị quảng cáo đến người dùng. Khi người dùng lướt net, phần mềm này sẽ tự thêm một quảng cáo nhỏ trên browser. Để có thể thêm quảng cáo vào bất cứ chỗ nào, phần mềm này tự ý cài một root certificate vào máy lenovo bán đi. Root certificate này lại là một certificate tự ký, bất cứ ai có máy lenovo đều có thể có được khóa bí mật ký certificate này. Điều này vô tình biến tất cả người dùng máy lenovo thành đối tượng bị làm giả certificate. Tất cả các liên lạc https đều có thể bị làm giả, do vậy việc làm này đã tạo ra một lỗi bảo mật rất nghiêm trọng.")]),t._v(" "),e("p",[t._v("Hãng Lenovo sau đó đã phải xin lỗi người dùng và đưa ra phần mềm gỡ bỏ tool này.")]),t._v(" "),e("p",[t._v("http://support.lenovo.com/vn/vi/product_security/superfish_uninstall")]),t._v(" "),e("h5",[t._v("OS quá cũ")]),t._v(" "),e("p",[t._v("Các root certificate đi kèm với máy chủ không phải có thời hạn mãi mãi mà được làm mới qua mỗi lần release một phiên bản của OS. Do vậy việc update OS thường xuyên là điều nên làm. Tuy vậy đối với các máy chủ làm việc bận rộn, việc nâng cấp nhiều khi là điều khó khăn. Từ đây nảy sinh một vấn đề như sau.")]),t._v(" "),e("p",[t._v("Máy chủ thỉnh thoảng hay phải gọi các https thông qua curl, ví dụ gọi twitter api qua https, hay gọi một dịch thanh toán nào đó qua Https. Giống như browser, curl dùng root certificate đi kèm để chứng thực các certificate phía dịch vụ gửi về. Tuy vậy khi root certificate hết hạn, việc chứng thực này sẽ thất bại, kéo theo việc app của bạn sẽ không chạy đúng nữa. Những lúc này việc update root certificate là việc cần phải làm.")]),t._v(" "),e("h3",[t._v("Kết luận")]),t._v(" "),e("p",[t._v("Bài viết trình bày khái quát nguyên tắc hoạt động của https cũng như các vấn đề xoay quanh liên lạc dùng https. Hy vọng qua bài viết bạn hiểu rõ hơn về https cũng như lý giải được tầm nghiêm trọng của những vấn đề và sự kiện xoay quanh https.")]),t._v(" "),e("p",[t._v("Bài này chủ yếu tham khảo và dịch lại 1 chút từ "),e("strong",[e("a",{attrs:{href:"https://kipalog.com/posts/https-hoat-dong-nhu-the-nao"}},[t._v("Nguồn Kipalog")])])])])}]};t.exports={attributes:{title:"Https Basic Memo",date:"2017-10-20T14:08:38.000Z",thumbnail:"posts/https.jpg",tags:["https"]},html:'<p><img src="https://i.stack.imgur.com/WRNrD.png" alt="Image">\nSource: <a href="https://stackoverflow.com/questions/470523/how-does-ssl-really-work">Source: StackOverFlow</a></p>\n<h2>日本語</h2>\n<ol>\n<li>ブラウザは<code>https://payment.com</code>に接続を成立する。</li>\n<li><code>https://payment.com</code>のサーバーはブラウザに証明書を送る。この証明書は公開鍵が含まれる。</li>\n<li>ブラウザは<code>https://payment.com</code>の証明書は有効であるものを確認する。※</li>\n<li>ステップ３を通過したら、ブラウザは新しい鍵（<code>K</code>と呼ばれる）を生成し、<code>https://payment.com</code>の公開鍵を使って暗号化してから<code>https://payment.com</code>に送信する</li>\n<li><code>https://payment.com</code>は機密鍵で<code>K</code>を複合化する</li>\n<li>ここからブラウザとサーバは<code>K</code>でデータ通信を行う。</li>\n</ol>\n<h2>Tiếng Việt.</h2>\n<ol>\n<li>Browser sẽ truy cập 1 trang web https. Ở đây là https://payment.com</li>\n<li>Server hay Load Balancer (LB) của payment.com sẽ trả về certificate để chứng thực rằng website user đang truy cập là website chính thức. Trong certificate là một public key PK, dùng để mã hóa K ở bước 4.</li>\n<li>Browser sẽ kiểm chứng certificate (bằng cách chạy thuật toán kiểm tra chữ ký). Quá trình này giúp browser xác định https://payment.com là thật hay giả.</li>\n<li>Sau khi kiểm chứng được certificate, browser sẽ tự sinh ra 1 khóa K. Khóa K sẽ được dùng để mã hóa tất cả các liên lạc giữa browser và payment.com sau này. Do quá trình mã hóa các gói tin dùng mã đối xứng, khóa K cần được gửi trở lại payment.com vì nếu không có K, server (LB) không thể nào giải mã được gói tin.</li>\n<li>Khóa K được gửi trả lại cho payment.com. Phía payment.com sẽ dùng private key (được bảo vệ) để giải mã gói tin này và qua đó có được thông tin về K.</li>\n<li>payment.com và browser dùng khóa K để mã hóa toàn bộ dữ liệu liên lạc sau này.</li>\n</ol>\n<p>Certificate là một khối dữ liệu bao gồm rất nhiều thông tin về payment.com. Các thông tin này bao gồm:</p>\n<ul>\n<li>Tên domain</li>\n<li>Tên công ty sở hữu</li>\n<li>Thời gian certificate được cấp</li>\n<li>Thời hạn certificate</li>\n<li>Public key PK</li>\n</ul>\n<h3>Làm thế nào browser kiểm chứng được certificate ở bước 3</h3>\n<p>Bất cứ người nào đứng giữa browser và payment.com đều có thể làm giả certificate và public key. Bằng cách làm giả certificate, người đứng giữa có thể giả dạng payment.com. Bằng cách giả public key, người đứng giữa có thể dùng khóa private của mình để xem thông tin truyển tải giữa 2 bên. Vậy làm thế nào để ngăn chặn cách tấn công này. Cách giải quyết là: CA (Certificate Authority).</p>\n<h4>CA là gì? Làm gì?</h4>\n<p>Trong thực tế, để chứng minh một ai đó trình độ đại học, trường đại học nơi người đó học sẽ cấp cho họ một tấm bằng. Do tấm bằng đó có thể bị làm giả, ta cần một đơn vị chứng minh đó là bằng thật. CA chính là người chứng minh certificate mà payment.com cung cấp là thật! CA bán dịch vụ chứng thực đó bằng cách ký chứng minh rằng certificate của payment.com là thật</p>\n<p>Certificate chứng thực cho payment.com sẽ được CA ký bằng khóa bí mật của CA. Khóa này chỉ có CA biết và do vậy việc chữ ký là an toàn. payment.com sẽ gửi cho user certificate đã được ký bởi CA cùng với khóa công khai PK2 của khóa bí mật CA dùng để ký certificate. Browser sẽ tiến hành kiểm tra certificate này như bình thường dùng khóa công khai PK2 của CA.</p>\n<p>Đến đây vấn đề chưa thực sự được giải quyết vì, khóa công khai của CA cũng hoàn toàn có thể bị làm giả và do vậy certificate hoàn toàn có thể là giả! Giống như thực tế người chứng minh cho tấm bằng đại học cũng có thể bị làm giả. Để chắc chắn việc này, ta có thể ký chứng thực certificate do CA ký là thật. Cách làm có thể hoàn toàn tương tự là dùng khóa bí mật nào đó và ký tiếp và đính kèm khóa công khai PK3 với certificate sau khi được ký. Cứ thế ta có một dãy các certificate và khóa công khai mà certificate sau chứng thực cho certificate trước. Do bản chất đệ quy, ta cần điểm dừng là một certificate mà ta hoàn toàn tin tưởng. Đến đây ta có khái niệm root certificate.</p>\n<h4>Root certificate</h4>\n<p>Root certificate là certificate mà ta hoàn toàn tin tưởng. Khi có certificate này, ta có thể tin tưởng những certificate mà được chứng thực bởi certificate này là hoàn toàn hợp lệ (giống trong thực tế là cơ quan công chứng!). Mỗi OS và browser có một danh sách các certificate mà OS và browser đó tin tưởng.</p>\n<p>Firefox tin tưởng các certificate có danh sách tại: https://wiki.mozilla.org/CA:IncludedCAs\nRHEL có danh sách các certificate tin tưởng tại: /etc/pki/tls/certs/</p>\n<p>Do root certificate là certificate cuối cùng dùng để chứng thực các certificate trong chuỗi, khóa bí mật của certificate này cần được bảo vệ nghiêm ngặt. Bất cứ công ty cung cấp dịch vụ CA nào bị tấn công và bị mất khóa bí mật của root certificate đều rất nguy hiểm, bởi vì hackers có thể dùng khóa đó để ký certificate ở bước cuối cùng. Do browser và OS tin tưởng certificate này nên tất cả certificate, không nhất thiết do CA bị hack cung cấp, đều có thể bị làm giả. Các CA do vậy dùng rất nhiều công sức để bảo vệ thật kín đáo khóa bí mật này. Kinh doanh chứng thực CA là kinh doanh về mặt lòng tin, CA hứa sẽ đảm bảo tốt nhất khóa bí mật của họ và ta trả tiền để họ dùng khóa bí mật của họ ký.</p>\n<p>Theo đồn đại của giang hồ, verisign dùng cửa lock dày và các tay súng chuyên nghiệp cùng hệ thống truy cập phức tạp để bảo vệ khóa bí mật này.</p>\n<h4>Xem certificate chain trong thực tế</h4>\n<p>Đến đây ta chắc đã hiểu phần nào về cơ chế chứng thực cũng như cách hoạt động của HTTPS. Ta sẽ cùng xem chuỗi certificate trong thực tế.</p>\n<p>Facebook certificate được ký bởi DigiCert High Assurance CA-3. Bản thân CA-3 được chứng thực bởi EV RootCA.</p>\n<h4>Các vấn đề liên quan đến https / certificate</h4>\n<p>Nguyên tắc hoạt động là như vậy, trong thực tế để duy trì và vận hành một hệ thống https cần tốn khá nhiều công sức. Dưới đây là một số case-studies mình gặp trong quá trình vận hành một website. Qua một số case-studies này hy vọng bạn sẽ hiểu tầm quan trọng của mỗi sự kiện và ý nghĩa của nó.</p>\n<h5>Heartbleed</h5>\n<p>Sự kiện heartbleed là sự kiện đình đám của năm 2014. Heartbleed là lỗi bảo mật nằm trong bộ thư viện OpenSSL, bộ thư viện chủ đạo xử lý mã hóa trên Linux. Các webserver đều được build sử dụng OpenSSL nếu muốn phục vụ https.</p>\n<p>Heartbleed xảy ra khi openssl không kiểm tra độ dài trả về của một chuỗi ký tự và vô tình trả về thông tin nằm sau chuỗi ký tự này trên bộ nhớ. Vô tình phần bộ nhớ này bao gồm khóa bí mật được dùng để ký certificate ban đầu. Bằng cách hỏi máy chủ cho xem chìa khóa bí mật này, hacker có thể dùng nó để giải mã khóa mã hóa liên lạc ở bước 5 và do đó đọc được toàn bộ nội dung của phiên liên lạc.</p>\n<p>Heartbleed nguy hiểm bởi việc tấn công này hoàn toàn không để lại dấu vết.</p>\n<p>Các công ty cung cấp dịch vụ qua https đã phải xử lý vấn đề này bao gồm các bước sau:</p>\n<ul>\n<li>Nâng cấp phiên bản openssl</li>\n<li>Khởi động lại máy chủ web (apache, nginx)</li>\n<li>Tạo một khóa bí mật mới, certificate mới và yêu cầu CAs ký lại</li>\n</ul>\n<h5>Diginostar</h5>\n<p>Diginostar là hãng CAs của Hà Lan bị hacker tấn công và lấy được khóa bí mật. Từ đó tất cả các root certificate của Diginostar đều bị xóa bỏ khỏi browser, do lo sợ hacker sẽ dùng khóa bí mật này làm giả certificate. Điều này dẫn đến sự phá sản của CA.</p>\n<p>Qua đấy mới thấy việc bảo vệ khóa bí mật an toàn là vấn đề sống còn của các CAs.</p>\n<h5>Superfish</h5>\n<p>Hãng máy tính Lenovo khi bán máy tính đã cài thêm một phần mềm hiển thị quảng cáo đến người dùng. Khi người dùng lướt net, phần mềm này sẽ tự thêm một quảng cáo nhỏ trên browser. Để có thể thêm quảng cáo vào bất cứ chỗ nào, phần mềm này tự ý cài một root certificate vào máy lenovo bán đi. Root certificate này lại là một certificate tự ký, bất cứ ai có máy lenovo đều có thể có được khóa bí mật ký certificate này. Điều này vô tình biến tất cả người dùng máy lenovo thành đối tượng bị làm giả certificate. Tất cả các liên lạc https đều có thể bị làm giả, do vậy việc làm này đã tạo ra một lỗi bảo mật rất nghiêm trọng.</p>\n<p>Hãng Lenovo sau đó đã phải xin lỗi người dùng và đưa ra phần mềm gỡ bỏ tool này.</p>\n<p>http://support.lenovo.com/vn/vi/product_security/superfish_uninstall</p>\n<h5>OS quá cũ</h5>\n<p>Các root certificate đi kèm với máy chủ không phải có thời hạn mãi mãi mà được làm mới qua mỗi lần release một phiên bản của OS. Do vậy việc update OS thường xuyên là điều nên làm. Tuy vậy đối với các máy chủ làm việc bận rộn, việc nâng cấp nhiều khi là điều khó khăn. Từ đây nảy sinh một vấn đề như sau.</p>\n<p>Máy chủ thỉnh thoảng hay phải gọi các https thông qua curl, ví dụ gọi twitter api qua https, hay gọi một dịch thanh toán nào đó qua Https. Giống như browser, curl dùng root certificate đi kèm để chứng thực các certificate phía dịch vụ gửi về. Tuy vậy khi root certificate hết hạn, việc chứng thực này sẽ thất bại, kéo theo việc app của bạn sẽ không chạy đúng nữa. Những lúc này việc update root certificate là việc cần phải làm.</p>\n<h3>Kết luận</h3>\n<p>Bài viết trình bày khái quát nguyên tắc hoạt động của https cũng như các vấn đề xoay quanh liên lạc dùng https. Hy vọng qua bài viết bạn hiểu rõ hơn về https cũng như lý giải được tầm nghiêm trọng của những vấn đề và sự kiện xoay quanh https.</p>\n<p>Bài này chủ yếu tham khảo và dịch lại 1 chút từ <strong><a href="https://kipalog.com/posts/https-hoat-dong-nhu-the-nao">Nguồn Kipalog</a></strong></p>\n',meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/https-basic-memo/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},345:function(t,n){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("h3",[t._v("よく使われるコマンドをAliasに")]),t._v(" "),e("p",[e("strong",[t._v("~/.zshrc or ~/.bash_profile or whatever you use")])]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("# append this line to the bottom\nsource ~/.aliases\n")])]),t._v(" "),e("p",[e("strong",[t._v("~/.aliases")])]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v('alias gs="git status"\nalias gl="git log"\nalias gaa="git add ."\nalias gc="git commit -m "\nalias gclean="git reset --hard && clean -df"\nalias projects="cd /Volumes/Data/projects "\nalias p="phpunit "\nalias pf="phpunit --filter "\n')])]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("source ~/.aliases\n")])]),t._v(" "),e("p",[t._v("これで "),e("strong",[t._v("gs")]),t._v("は"),e("strong",[t._v("git status")]),t._v("、"),e("strong",[t._v("gc")]),t._v("はコミットなど便利に使える。")]),t._v(" "),e("h3",[t._v("複数Pythonバージョンがあっても、"),e("strong",[t._v("PATH")]),t._v("変更せず、好みバージョン使用できる")]),t._v(" "),e("p",[e("strong",[t._v("python2")]),t._v("と"),e("strong",[t._v("python3")]),t._v("が混在な環境では"),e("strong",[t._v("python3")]),t._v("コマンドを打つのは面倒だね。")]),t._v(" "),e("p",[e("strong",[t._v("~/.aliases")])]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v('alias python="python3"\n')])]),t._v(" "),e("h3",[t._v("デフォルトの"),e("strong",[t._v("Terminal")]),t._v("より、**Oh My ZSH!**を使う")]),t._v(" "),e("p",[t._v("メリットは様々だが、https://ohmyz.sh/をご確認ください")]),t._v(" "),e("h3",[t._v("Flutter Catalina error")]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("sudo xattr -d com.apple.quarantine ~/thanhchungbui/flutter/bin/cache/artifacts/libimobiledevice/idevice_id\nsudo xattr -d com.apple.quarantine ~/flutter/bin/cache/artifacts/libimobiledevice/idevice_id\nsudo xattr -d com.apple.quarantine ~/flutter/bin/cache/artifacts/libimobiledevice/ideviceinfo\nsudo xattr -d com.apple.quarantine ~/flutter/bin/cache/artifacts/usbmuxd/iproxy\n")])])])}]};t.exports={attributes:{title:"開発マシンのTips",date:"2018-06-23T12:23:22.000Z",thumbnail:"posts/terminal.jpg",description:"Some of my mac tips & tricks",draft:!1,tags:["linux","mac","tip"]},html:'<h3>よく使われるコマンドをAliasに</h3>\n<p><strong>~/.zshrc or ~/.bash_profile or whatever you use</strong></p>\n<pre class="language-sh"><code class="language-sh"># append this line to the bottom\nsource ~/.aliases\n</code></pre>\n<p><strong>~/.aliases</strong></p>\n<pre class="language-sh"><code class="language-sh">alias gs=&quot;git status&quot;\nalias gl=&quot;git log&quot;\nalias gaa=&quot;git add .&quot;\nalias gc=&quot;git commit -m &quot;\nalias gclean=&quot;git reset --hard &amp;&amp; clean -df&quot;\nalias projects=&quot;cd /Volumes/Data/projects &quot;\nalias p=&quot;phpunit &quot;\nalias pf=&quot;phpunit --filter &quot;\n</code></pre>\n<pre class="language-sh"><code class="language-sh">source ~/.aliases\n</code></pre>\n<p>これで <strong>gs</strong>は<strong>git status</strong>、<strong>gc</strong>はコミットなど便利に使える。</p>\n<h3>複数Pythonバージョンがあっても、<strong>PATH</strong>変更せず、好みバージョン使用できる</h3>\n<p><strong>python2</strong>と<strong>python3</strong>が混在な環境では<strong>python3</strong>コマンドを打つのは面倒だね。</p>\n<p><strong>~/.aliases</strong></p>\n<pre class="language-sh"><code class="language-sh">alias python=&quot;python3&quot;\n</code></pre>\n<h3>デフォルトの<strong>Terminal</strong>より、**Oh My ZSH!**を使う</h3>\n<p>メリットは様々だが、https://ohmyz.sh/をご確認ください</p>\n<h3>Flutter Catalina error</h3>\n<pre class="language-sh"><code class="language-sh">sudo xattr -d com.apple.quarantine ~/thanhchungbui/flutter/bin/cache/artifacts/libimobiledevice/idevice_id\nsudo xattr -d com.apple.quarantine ~/flutter/bin/cache/artifacts/libimobiledevice/idevice_id\nsudo xattr -d com.apple.quarantine ~/flutter/bin/cache/artifacts/libimobiledevice/ideviceinfo\nsudo xattr -d com.apple.quarantine ~/flutter/bin/cache/artifacts/usbmuxd/iproxy\n</code></pre>\n',meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/mac-dev-tips/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},346:function(t,n){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("p",[t._v("特に大した改修をしていないのに、システムをstagingでリリースした時、いきなり前面的に止まったので、結構ハマった。\n小さなことですごく影響が多いなと感じでした。")]),t._v(" "),e("h2",[t._v("問題")]),t._v(" "),e("p",[t._v("Linuxサーバへデプロイした時、Responseコード200にも関わらず、「"),e("strong",[t._v("Gzipが不正よ")]),t._v("」と文句言われ、ブラウザ開けないことがあった。")]),t._v(" "),e("h2",[t._v("原因")]),t._v(" "),e("p",[t._v("かなりレガシシステムなので、"),e("code",{pre:!0},[t._v('ob_start("ob_gzhandler");')]),t._v("で"),e("code",{pre:!0},[t._v("gzip")]),t._v("レスポンスを作っている。\n"),e("strong",[t._v("gzip")]),t._v("レスポンスを分析したところ、PHPソースファイルにBOMが入っていて、正しくないGzipファイルを作って送信したような原因だった。")]),t._v(" "),e("p",[t._v("※BOMは"),e("strong",[t._v("EF BB BF")]),t._v("で確認可能")]),t._v(" "),e("p",[t._v("Windows上のエディターでは「"),e("strong",[t._v("UTF-8 BOM付で保存")]),t._v("」というエディターの設定があり、この設定でファイル保存かもしれない。")]),t._v(" "),e("h2",[t._v("対策")]),t._v(" "),e("p",[t._v("全て"),e("strong",[t._v("UTF-8 BOM付")]),t._v("のソースファイルを抽出し、BOMを消せば、正常に動いた。")]),t._v(" "),e("h3",[t._v("BOM付きファイル抽出")]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("grep -rl $'\\xEF\\xBB\\xBF' .\n")])]),t._v(" "),e("h3",[t._v("BOMを排除する")]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("sed -i '1 s/^\\xef\\xbb\\xbf//' *.php\n")])])])}]};t.exports={attributes:{title:"[PHP]UTF-8 BOMにやられた",date:"2018-02-13T10:16:40.000Z",description:"",thumbnail:"posts/bom.jpeg",tags:["php","bom"]},html:'<p>特に大した改修をしていないのに、システムをstagingでリリースした時、いきなり前面的に止まったので、結構ハマった。\n小さなことですごく影響が多いなと感じでした。</p>\n<h2>問題</h2>\n<p>Linuxサーバへデプロイした時、Responseコード200にも関わらず、「<strong>Gzipが不正よ</strong>」と文句言われ、ブラウザ開けないことがあった。</p>\n<h2>原因</h2>\n<p>かなりレガシシステムなので、<code>ob_start(&quot;ob_gzhandler&quot;);</code>で<code>gzip</code>レスポンスを作っている。\n<strong>gzip</strong>レスポンスを分析したところ、PHPソースファイルにBOMが入っていて、正しくないGzipファイルを作って送信したような原因だった。</p>\n<p>※BOMは<strong>EF BB BF</strong>で確認可能</p>\n<p>Windows上のエディターでは「<strong>UTF-8 BOM付で保存</strong>」というエディターの設定があり、この設定でファイル保存かもしれない。</p>\n<h2>対策</h2>\n<p>全て<strong>UTF-8 BOM付</strong>のソースファイルを抽出し、BOMを消せば、正常に動いた。</p>\n<h3>BOM付きファイル抽出</h3>\n<pre class="language-sh"><code class="language-sh">grep -rl $\'\\xEF\\xBB\\xBF\' .\n</code></pre>\n<h3>BOMを排除する</h3>\n<pre class="language-sh"><code class="language-sh">sed -i \'1 s/^\\xef\\xbb\\xbf//\' *.php\n</code></pre>\n',meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/php-suck-bom-utf8/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},347:function(t,n){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("p",[e("code",{pre:!0},[t._v("psql")]),t._v("や何かのSQLツールで、SQLを実行した時、このエラーが出ると、その後クエリが実行できなくなることがあったので、調べてみた。")]),t._v(" "),e("p",[t._v("原因は簡単だが、大量クエリを実行したので、気づかず、結構ハマった！")]),t._v(" "),e("h2",[t._v("原因")]),t._v(" "),e("p",[e("code",{pre:!0},[t._v("Transaction")]),t._v("内に一度エラーが発生すると、明示的にその"),e("code",{pre:!0},[t._v("Transaction")]),t._v("を"),e("code",{pre:!0},[t._v("abort")]),t._v("しなければならないようだ。")]),t._v(" "),e("p",[e("code",{pre:!0},[t._v("SQL Server")]),t._v("等の他のRDBMSだと、エラーが出てきても、その場で直して、処理を続けるんだね。")]),t._v(" "),e("p",[t._v("[例]")]),t._v(" "),e("pre",{staticClass:"language-sql"},[e("code",{pre:!0,attrs:{class:"language-sql"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("begin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nselet "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" foo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("p",[t._v("このクエリを実行すると、"),e("code",{pre:!0},[t._v("「ERROR: syntax error at or near ‘selet’“」")]),t._v("が出るはず。"),e("br"),t._v("\nこれで正しく"),e("code",{pre:!0},[t._v("select * from foo;")]),t._v("に修正し、再度実行をすると、冒頭のエラーが出て実行できなかった。"),e("br"),t._v("\n因みに、"),e("code",{pre:!0},[t._v("sqlserver")]),t._v("はこの問題が発生しないようだ。")]),t._v(" "),e("h2",[t._v("対策")]),t._v(" "),e("p",[t._v("エラーが出たら、")]),t._v(" "),e("pre",[e("code",{pre:!0},[t._v("rollback;\n")])]),t._v(" "),e("p",[t._v("を実行しなければならない。")]),t._v(" "),e("h2",[t._v("なぜ"),e("code",{pre:!0},[t._v("Postgres")]),t._v("はそうなったのか？")]),t._v(" "),e("p",[e("code",{pre:!0},[t._v("Postgres")]),t._v("はユーザで終了した"),e("code",{pre:!0},[t._v("Transaction")]),t._v("とシステムの都合(例外等）で終了した"),e("code",{pre:!0},[t._v("Transaction")]),t._v("は区別しているようだ。\n"),e("a",{attrs:{href:"https://github.com/postgres/postgres/blob/master/src/backend/access/transam/README"}},[t._v("https://github.com/postgres/postgres/blob/master/src/backend/access/transam/README")]),t._v("を参照すると、")]),t._v(" "),e("blockquote",[e("ul",[e("li",[e("ol",[e("li",[t._v("システムの都合で"),e("code",{pre:!0},[t._v("Transaction")]),t._v("が終了した場合：AbortCurrentTransaction アプリケーション状態はTBLOCK_ABORT")])])]),t._v(" "),e("li",[e("ol",{attrs:{start:"2"}},[e("li",[t._v("ユーザで"),e("code",{pre:!0},[t._v("Transaction")]),t._v("を終了した場合：UserAbortTransactionBlock アプリケーション状態はTBLOCK_ABORT_END")])])])])]),t._v(" "),e("p",[t._v("ケース１でも自動に"),e("code",{pre:!0},[t._v("Transaction")]),t._v("を終了させれば良いでしょうかって思うよね。\n実はそれに応じる"),e("code",{pre:!0},[t._v("onerrorrollback")]),t._v("オプションがあるが、やっぱり長い"),e("code",{pre:!0},[t._v("Transaction")]),t._v("内にエラーが発生したら、最初から実施しないといけない点は不便が感じるよね〜\n"),e("code",{pre:!0},[t._v("onerrorrollback")]),t._v("についての詳細説明も是非ご参照ください。\n"),e("a",{attrs:{href:"https://www.endpoint.com/blog/2015/02/24/postgres-onerrorrollback-explained"}},[t._v("https://www.endpoint.com/blog/2015/02/24/postgres-onerrorrollback-explained")])])])}]};t.exports={attributes:{title:"[Postgres] current transaction is aborted, commands ignored until end of transaction block",date:"2018-01-11T22:15:40.000Z",description:"postgresの特殊な扱いに不注意でハマった為、メモした",thumbnail:"posts/postgres-elephant.png",featured_image:"postgres-current-transaction-is-aborted/featured.png",tags:["postgres"]},html:'<p><code>psql</code>や何かのSQLツールで、SQLを実行した時、このエラーが出ると、その後クエリが実行できなくなることがあったので、調べてみた。</p>\n<p>原因は簡単だが、大量クエリを実行したので、気づかず、結構ハマった！</p>\n<h2>原因</h2>\n<p><code>Transaction</code>内に一度エラーが発生すると、明示的にその<code>Transaction</code>を<code>abort</code>しなければならないようだ。</p>\n<p><code>SQL Server</code>等の他のRDBMSだと、エラーが出てきても、その場で直して、処理を続けるんだね。</p>\n<p>[例]</p>\n<pre class="language-sql"><code class="language-sql"><span class="token keyword">begin</span><span class="token punctuation">;</span>\nselet <span class="token operator">*</span> <span class="token keyword">from</span> foo<span class="token punctuation">;</span>\n</code></pre>\n<p>このクエリを実行すると、<code>「ERROR: syntax error at or near ‘selet’“」</code>が出るはず。<br>\nこれで正しく<code>select * from foo;</code>に修正し、再度実行をすると、冒頭のエラーが出て実行できなかった。<br>\n因みに、<code>sqlserver</code>はこの問題が発生しないようだ。</p>\n<h2>対策</h2>\n<p>エラーが出たら、</p>\n<pre><code>rollback;\n</code></pre>\n<p>を実行しなければならない。</p>\n<h2>なぜ<code>Postgres</code>はそうなったのか？</h2>\n<p><code>Postgres</code>はユーザで終了した<code>Transaction</code>とシステムの都合(例外等）で終了した<code>Transaction</code>は区別しているようだ。\n<a href="https://github.com/postgres/postgres/blob/master/src/backend/access/transam/README">https://github.com/postgres/postgres/blob/master/src/backend/access/transam/README</a>を参照すると、</p>\n<blockquote>\n<ul>\n<li>\n<ol>\n<li>システムの都合で<code>Transaction</code>が終了した場合：AbortCurrentTransaction アプリケーション状態はTBLOCK_ABORT</li>\n</ol>\n</li>\n<li>\n<ol start="2">\n<li>ユーザで<code>Transaction</code>を終了した場合：UserAbortTransactionBlock アプリケーション状態はTBLOCK_ABORT_END</li>\n</ol>\n</li>\n</ul>\n</blockquote>\n<p>ケース１でも自動に<code>Transaction</code>を終了させれば良いでしょうかって思うよね。\n実はそれに応じる<code>onerrorrollback</code>オプションがあるが、やっぱり長い<code>Transaction</code>内にエラーが発生したら、最初から実施しないといけない点は不便が感じるよね〜\n<code>onerrorrollback</code>についての詳細説明も是非ご参照ください。\n<a href="https://www.endpoint.com/blog/2015/02/24/postgres-onerrorrollback-explained">https://www.endpoint.com/blog/2015/02/24/postgres-onerrorrollback-explained</a></p>\n',meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/postgres-current-transaction-is-aborted/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},348:function(t,n){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("h2",[t._v("Useful Postgres command")]),t._v(" "),e("h3",[t._v("1. Move DB to another server")]),t._v(" "),e("pre",{staticClass:"language-shell"},[e("code",{pre:!0,attrs:{class:"language-shell"}},[t._v("pg_dump -C -h sourceip -U username password "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" psql -h destinationip -U username\n")])]),t._v(" "),e("h3",[t._v("2. Init, start, restart")]),t._v(" "),e("pre",{staticClass:"language-shell"},[e("code",{pre:!0,attrs:{class:"language-shell"}},[t._v("initdb -D /path/to/data/folder\npg_ctl -D /path/to/data/folder start\npg_ctl -D /path/to/data/folder restart\n")])]),t._v(" "),e("h3",[t._v("3. Config file")]),t._v(" "),e("ul",[e("li",[t._v("pg_hba.config: use to config authentication method")]),t._v(" "),e("li",[t._v("postgres.conf: use to config listenning host, etc.")])]),t._v(" "),e("h3",[t._v("4. Config authentication")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("For server")])])]),t._v(" "),e("pre",{staticClass:"language-shell"},[e("code",{pre:!0,attrs:{class:"language-shell"}},[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /path/to/pg_hba.conf\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# add the following line:")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v("    all             all             "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.0")]),t._v(".0.70/32            md5\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# change IP address")]),t._v("\n")])]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("For client")]),e("br"),t._v("\nCreate ~/.pgpass and add the following line")])]),t._v(" "),e("pre",{staticClass:"language-shell"},[e("code",{pre:!0,attrs:{class:"language-shell"}},[t._v("host:port:dbname:usr:pwd\n")])]),t._v(" "),e("p",[t._v("change permission")]),t._v(" "),e("pre",{staticClass:"language-shell"},[e("code",{pre:!0,attrs:{class:"language-shell"}},[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" 0600 ~/.pgpass\n")])])])}]};t.exports={attributes:{title:"Postgres Memo",date:"2017-07-24T22:04:16.000Z",description:null,thumbnail:"posts/postgres-elephant.png",tags:["postgres"]},html:'<h2>Useful Postgres command</h2>\n<h3>1. Move DB to another server</h3>\n<pre class="language-shell"><code class="language-shell">pg_dump -C -h sourceip -U username password <span class="token operator">|</span> psql -h destinationip -U username\n</code></pre>\n<h3>2. Init, start, restart</h3>\n<pre class="language-shell"><code class="language-shell">initdb -D /path/to/data/folder\npg_ctl -D /path/to/data/folder start\npg_ctl -D /path/to/data/folder restart\n</code></pre>\n<h3>3. Config file</h3>\n<ul>\n<li>pg_hba.config: use to config authentication method</li>\n<li>postgres.conf: use to config listenning host, etc.</li>\n</ul>\n<h3>4. Config authentication</h3>\n<ul>\n<li><strong>For server</strong></li>\n</ul>\n<pre class="language-shell"><code class="language-shell"><span class="token function">vim</span> /path/to/pg_hba.conf\n<span class="token comment"># add the following line:</span>\n<span class="token function">host</span>    all             all             <span class="token number">10.0</span>.0.70/32            md5\n<span class="token comment"># change IP address</span>\n</code></pre>\n<ul>\n<li><strong>For client</strong><br>\nCreate ~/.pgpass and add the following line</li>\n</ul>\n<pre class="language-shell"><code class="language-shell">host:port:dbname:usr:pwd\n</code></pre>\n<p>change permission</p>\n<pre class="language-shell"><code class="language-shell"><span class="token function">chmod</span> 0600 ~/.pgpass\n</code></pre>\n',meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/postgres-memo/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},349:function(t,n){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("h2",[t._v("問題")]),t._v(" "),e("p",[e("code",{pre:!0},[t._v("psql")]),t._v("でSQLを指定して実行できるが、例えば複数SQLを同時に実行させ、また前のSQLの結果によって、続行するかしないかという条件付きの複雑SQLを実行することができない。")]),t._v(" "),e("p",[t._v("今回以下のようにShell scriptを作りたい。")]),t._v(" "),e("pre",{staticClass:"language-shell"},[e("code",{pre:!0,attrs:{class:"language-shell"}},[e("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("ConnectDb")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PGPASSWORD")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("postgres psql -U postgres database -t -A -F , -v "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ON_ERROR_STOP")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" -v "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("AUTOCOMMIT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("printMsg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PROGRAM")]),t._v("/"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SUBMODULE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"+ %Y%H%s"')]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" -a ~/Desktop/shell/log/test.log\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nConnectDb "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('EOF\n  start transaction;\n\n  select * from ...;\n  # other database stubs\n\n  # addtional operations like logging come here\n  printMsg "Querying ..."\n\n  # mix of conditional shell and psql command\n  if [ some accepted condition ] commit;\n  if [ some bad conditions ] rollback;\n  if [ should do more database query ] do some CRUD actions\n  \n  commit;\nEOF')]),t._v("\n")])]),t._v(" "),e("h2",[t._v("解決方法")]),t._v(" "),e("p",[e("code",{pre:!0},[t._v("shell")]),t._v("と"),e("code",{pre:!0},[t._v("SQL")]),t._v("が混在する為、単純の"),e("code",{pre:!0},[t._v("psql")]),t._v("に制御コマンドを入れることができない。")]),t._v(" "),e("blockquote",[e("p",[t._v("ちなみに、"),e("code",{pre:!0},[t._v("db2")]),t._v("はこのような"),e("code",{pre:!0},[t._v("shell")]),t._v("scriptを簡単に作れる。")])]),t._v(" "),e("p",[t._v("ここで、"),e("code",{pre:!0},[t._v("coproc")]),t._v("を使えば、実現可能なことがわかった。")]),t._v(" "),e("p",[e("code",{pre:!0},[t._v("coproc")]),t._v("の詳細は"),e("a",{attrs:{href:"https://unix.stackexchange.com/questions/86270/how-do-you-use-the-command-coproc-in-various-shells"}},[t._v("stackoverflow")]),t._v("ですごいわかりやすい回答があるので、ご参考ください。")]),t._v(" "),e("h3",[e("code",{pre:!0},[t._v("psql")]),t._v("をバックグラウンドで動かせる")]),t._v(" "),e("h3",[e("code",{pre:!0},[t._v("psql")]),t._v("にSQLを取り入れる")]),t._v(" "),e("h3",[e("code",{pre:!0},[t._v("SQL")]),t._v("の実行結果を確認する")])])}]};t.exports={attributes:{title:"[Shell]Shellで複雑なトランザクション制御方法",description:"shで条件付きのSQLを実行する時などに役に立つ",date:"2017-08-02T23:46:25.000Z",thumbnail:"posts/linux-shell.png",draft:!1,tags:["shell","postgres","coprocess","linux"]},html:'<h2>問題</h2>\n<p><code>psql</code>でSQLを指定して実行できるが、例えば複数SQLを同時に実行させ、また前のSQLの結果によって、続行するかしないかという条件付きの複雑SQLを実行することができない。</p>\n<p>今回以下のようにShell scriptを作りたい。</p>\n<pre class="language-shell"><code class="language-shell"><span class="token function-name function">ConnectDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\t <span class="token assign-left variable">PGPASSWORD</span><span class="token operator">=</span>postgres psql -U postgres database -t -A -F , -v <span class="token assign-left variable">ON_ERROR_STOP</span><span class="token operator">=</span><span class="token number">1</span> -v <span class="token assign-left variable">AUTOCOMMIT</span><span class="token operator">=</span><span class="token number">0</span>\n<span class="token punctuation">}</span>\n\n<span class="token function-name function">printMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\t<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$PROGRAM</span>/<span class="token variable">$SUBMODULE</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token string">"+ %Y%H%s"</span><span class="token variable">)</span></span>"</span> <span class="token variable">$1</span> <span class="token operator">|</span> <span class="token function">tee</span> -a ~/Desktop/shell/log/test.log\n<span class="token punctuation">}</span>\n\nConnectDb <span class="token operator">&lt;&lt;</span><span class="token string">EOF\n  start transaction;\n\n  select * from ...;\n  # other database stubs\n\n  # addtional operations like logging come here\n  printMsg "Querying ..."\n\n  # mix of conditional shell and psql command\n  if [ some accepted condition ] commit;\n  if [ some bad conditions ] rollback;\n  if [ should do more database query ] do some CRUD actions\n  \n  commit;\nEOF</span>\n</code></pre>\n<h2>解決方法</h2>\n<p><code>shell</code>と<code>SQL</code>が混在する為、単純の<code>psql</code>に制御コマンドを入れることができない。</p>\n<blockquote>\n<p>ちなみに、<code>db2</code>はこのような<code>shell</code>scriptを簡単に作れる。</p>\n</blockquote>\n<p>ここで、<code>coproc</code>を使えば、実現可能なことがわかった。</p>\n<p><code>coproc</code>の詳細は<a href="https://unix.stackexchange.com/questions/86270/how-do-you-use-the-command-coproc-in-various-shells">stackoverflow</a>ですごいわかりやすい回答があるので、ご参考ください。</p>\n<h3><code>psql</code>をバックグラウンドで動かせる</h3>\n<h3><code>psql</code>にSQLを取り入れる</h3>\n<h3><code>SQL</code>の実行結果を確認する</h3>\n',meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/shell-postgres-transaction-control/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},350:function(t,n){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("p",[t._v("Việc gửi trẻ ở Nhật không giống với Việt Nam là thích gửi đâu cũng được, mà trước tiên bạn phải nộp hồ sơ xếp hàng và nếu đủ điều kiện thì mới được đi học.\nKhá là vất vả.")]),t._v(" "),e("p",[t._v("Gần đây mình cũng mới làm thủ tục cho thằng cu ở nhà nên note lại 1 số kinh nghiệm.")]),t._v(" "),e("h2",[t._v("Sơ lược")]),t._v(" "),e("p",[t._v("Hệ thống giáo dục mầm non ở Nhật là tự nguyện, và do "),e("strong",[t._v("自治体")]),t._v("(quận, thành phố) quản lý. Gồm các loại trường:")]),t._v(" "),e("ul",[e("li",[t._v("認可保育園")]),t._v(" "),e("li",[t._v("認定こども園")])]),t._v(" "),e("p",[t._v("Ngoài ra tuỳ thành phố còn có:")]),t._v(" "),e("ul",[e("li",[t._v("認定こどもルーム")])]),t._v(" "),e("p",[t._v("Trẻ dưới 3 tuổi được khuyến khích tốt nhất nên ở với Bố Mẹ nên nếu không có lý do chính đáng, không thể xin cho con đi học được.\nChỉ có mấy trường hợp dưới đây là xin được.")]),t._v(" "),e("ul",[e("li",[t._v("Cả Bố và Mẹ đều đi làm full time.("),e("strong",[t._v("共働き")]),t._v(")")]),t._v(" "),e("li",[t._v("Bố hoặc Mẹ đi full time, người còn lại đi học > 64h/tháng")]),t._v(" "),e("li",[t._v("Bố hoặc Mẹ đi full time, người còn lại đi làm part time > 64h/tháng")])]),t._v(" "),e("h2",[t._v("Các thủ tục cần thiết")]),t._v(" "),e("ol",[e("li",[e("strong",[t._v("就労証明書")]),t._v(": giấy chứng nhận đi làm")]),t._v(" "),e("li",[e("strong",[t._v("在学証明書")]),t._v(": giấy chứng nhận đi học")]),t._v(" "),e("li",[e("strong",[t._v("スケジュール表")]),t._v(":trong trường hợp đi học")]),t._v(" "),e("li",[e("strong",[t._v("申込書")]),t._v(":Tờ khai nguyện vọng\nNếu đang tìm việc thì cần nộp "),e("strong",[t._v("承諾書")])])]),t._v(" "),e("p",[t._v("Việc khai tờ nguyện vọng thì lúc đầu mình chỉ viết có 3 trường, sau đấy đi nộp thì họ nói cứ viết càng nhiều càng tốt."),e("br"),t._v("\nVả kết cục là mình khai nguyện vọng những 20 trường.")]),t._v(" "),e("h2",[t._v("Xét duỵệt thế nào")]),t._v(" "),e("p",[t._v("Sau khi nộp hồ sơ thì họ sẽ đánh giá và cho bạn 1 số điểm tương ứng.")]),t._v(" "),e("p",[t._v("Nếu còn chỗ trống thì sẽ ưu tiên người có điểm số cao hơn vào trước. Thời gian xếp hàng không phải là hạng mục đánh giá nên cho dù bạn có xếp 1 năm mà luôn luôn có người điểm cao hơn bạn đang chờ thì bạn cũng không được vào.")]),t._v(" "),e("h2",[t._v("Học phí")]),t._v(" "),e("p",[t._v("Dựa vào mức đóng thuế thị dân ("),e("strong",[t._v("住民税")]),t._v(")để quyết định.")]),t._v(" "),e("ul",[e("li",[t._v("Trẻ dưới 3 tuổi thì phải đóng học phí (học phí đã bao gồm cả tiền ăn uống)")]),t._v(" "),e("li",[t._v("Trẻ trên 3 tuổi thì được miễn học phí, chỉ phải đóng tiền ăn hàng tháng.")])]),t._v(" "),e("h2",[t._v("Kết quả")]),t._v(" "),e("p",[e("strong",[t._v("不承諾!")])]),t._v(" "),e("p",[t._v("Sau đó thì họ có gọi và thông báo rằng trượt 保育園 nhưng ベビールーム thì vẫn còn chỗ trống nên có muốn vào không?\nベビールーム thường chỉ là 1 phòng rất bé mà học phí lại đắt. "),e("br"),t._v("\nMình cho con học được ở đấy gần 1 tháng thì phường gọi báo đỗ "),e("strong",[t._v("nguyện vọng 10😅")]),t._v("\nThế là lại khăn gói chuyển trường.")])])}]};t.exports={attributes:{title:"Kinh nghiệm làm thủ tục gửi 保育園",thumbnail:"posts/kindergarden.jpg",date:"2019-03-20T13:28:04.000Z",tags:["life"]},html:"<p>Việc gửi trẻ ở Nhật không giống với Việt Nam là thích gửi đâu cũng được, mà trước tiên bạn phải nộp hồ sơ xếp hàng và nếu đủ điều kiện thì mới được đi học.\nKhá là vất vả.</p>\n<p>Gần đây mình cũng mới làm thủ tục cho thằng cu ở nhà nên note lại 1 số kinh nghiệm.</p>\n<h2>Sơ lược</h2>\n<p>Hệ thống giáo dục mầm non ở Nhật là tự nguyện, và do <strong>自治体</strong>(quận, thành phố) quản lý. Gồm các loại trường:</p>\n<ul>\n<li>認可保育園</li>\n<li>認定こども園</li>\n</ul>\n<p>Ngoài ra tuỳ thành phố còn có:</p>\n<ul>\n<li>認定こどもルーム</li>\n</ul>\n<p>Trẻ dưới 3 tuổi được khuyến khích tốt nhất nên ở với Bố Mẹ nên nếu không có lý do chính đáng, không thể xin cho con đi học được.\nChỉ có mấy trường hợp dưới đây là xin được.</p>\n<ul>\n<li>Cả Bố và Mẹ đều đi làm full time.(<strong>共働き</strong>)</li>\n<li>Bố hoặc Mẹ đi full time, người còn lại đi học &gt; 64h/tháng</li>\n<li>Bố hoặc Mẹ đi full time, người còn lại đi làm part time &gt; 64h/tháng</li>\n</ul>\n<h2>Các thủ tục cần thiết</h2>\n<ol>\n<li><strong>就労証明書</strong>: giấy chứng nhận đi làm</li>\n<li><strong>在学証明書</strong>: giấy chứng nhận đi học</li>\n<li><strong>スケジュール表</strong>:trong trường hợp đi học</li>\n<li><strong>申込書</strong>:Tờ khai nguyện vọng\nNếu đang tìm việc thì cần nộp <strong>承諾書</strong></li>\n</ol>\n<p>Việc khai tờ nguyện vọng thì lúc đầu mình chỉ viết có 3 trường, sau đấy đi nộp thì họ nói cứ viết càng nhiều càng tốt.<br>\nVả kết cục là mình khai nguyện vọng những 20 trường.</p>\n<h2>Xét duỵệt thế nào</h2>\n<p>Sau khi nộp hồ sơ thì họ sẽ đánh giá và cho bạn 1 số điểm tương ứng.</p>\n<p>Nếu còn chỗ trống thì sẽ ưu tiên người có điểm số cao hơn vào trước. Thời gian xếp hàng không phải là hạng mục đánh giá nên cho dù bạn có xếp 1 năm mà luôn luôn có người điểm cao hơn bạn đang chờ thì bạn cũng không được vào.</p>\n<h2>Học phí</h2>\n<p>Dựa vào mức đóng thuế thị dân (<strong>住民税</strong>)để quyết định.</p>\n<ul>\n<li>Trẻ dưới 3 tuổi thì phải đóng học phí (học phí đã bao gồm cả tiền ăn uống)</li>\n<li>Trẻ trên 3 tuổi thì được miễn học phí, chỉ phải đóng tiền ăn hàng tháng.</li>\n</ul>\n<h2>Kết quả</h2>\n<p><strong>不承諾!</strong></p>\n<p>Sau đó thì họ có gọi và thông báo rằng trượt 保育園 nhưng ベビールーム thì vẫn còn chỗ trống nên có muốn vào không?\nベビールーム thường chỉ là 1 phòng rất bé mà học phí lại đắt. <br>\nMình cho con học được ở đấy gần 1 tháng thì phường gọi báo đỗ <strong>nguyện vọng 10😅</strong>\nThế là lại khăn gói chuyển trường.</p>\n",meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/thu-tuc-gui-tre/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},351:function(t,n){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("h2",[t._v("Tham khảo")]),t._v(" "),e("p",[t._v("https://www.vn.emb-japan.go.jp/itpr_ja/VN_SVisaFAM.html")]),t._v(" "),e("h2",[t._v("Người xin visa")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("Hộ chiếu"),e("br"),t._v("\n-> Bản gốc")])]),t._v(" "),e("li",[e("p",[t._v("Tờ khai visa (có dán ảnh)"),e("br"),t._v("\n-> 1 bản gốc"),e("br"),t._v("\nhttps://www.vn.emb-japan.go.jp/itpr_ja/VN_SVisaFAM.html")])]),t._v(" "),e("li",[e("p",[t._v("Tài liệu chứng minh quan hệ họ hàng với người mời"),e("br"),t._v("\n-> Sổ hộ khẩu: Mang theo 1 bản gốc và 1 bản photo")])]),t._v(" "),e("li",[e("p",[t._v("Giấy tờ đặt vé (Khi nhận đc visa mới thanh toán)"),e("br"),t._v("\n-> Bản gốc")])])]),t._v(" "),e("h2",[t._v("Người mời và bảo lãnh")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("Giấy lý do mời"),e("br"),t._v("\n-> BẢN GỐC"),e("br"),t._v("\n-> Danh sách người xin visa"),e("br"),t._v("\n-> Chú ý đóng dấu")])]),t._v(" "),e("li",[e("p",[t._v("Lịch trình"),e("br"),t._v("\nChú ý là file này không thể lưu được nên viết xong phải in luôn")])])]),t._v(" "),e("p",[e("strong",[t._v("Nếu người mời bảo lãnh sang thì cần thêm:")]),e("br"),t._v("\n3. Giấy chứng nhận bảo lãnh gồm"),e("br"),t._v("\n-> Giấy chứng nhận bảo lãnh 1 BẢN GỐC -> Chú ý đóng dầu"),e("br"),t._v("\n-> Giấy chứng nhận nộp thuế có ghi tổng thu nhập"),e("br"),t._v("\n-> Giấy số dư ngân hàng"),e("br"),t._v("\n-> Phiếu công dân"),e("br"),t._v("\n-> Photo 2 mặt thẻ ngoại kiều"),e("br"),t._v("\n-> Photo hộ chiếu trang ảnh và trang liên quan đến xuất nhập cảnh và lưu trú"),e("br"),t._v("\n-> Giấy chứng nhận đang làm việc xin từ công ty (在籍証明書)")]),t._v(" "),e("h2",[t._v("Gửi giấy tờ về Việt Nam")]),t._v(" "),e("ul",[e("li",[t._v("Ra "),e("strong",[t._v("郵便局")]),t._v(" gửi chuyển phát nhanh EMS về Việt Nam.")]),t._v(" "),e("li",[t._v("Chi phí hết khoảng 2000 yên tuỳ vùng")])]),t._v(" "),e("h2",[t._v("Sau bao lâu thì xong thủ tục")]),t._v(" "),e("ul",[e("li",[t._v("Khoảng 2 ngày - 1 tuần là nhận được là người ở Việt Nam nhận được giấy tờ")]),t._v(" "),e("li",[t._v("Làm thủ tục ở Việt Nam mất khoảng 8 ngày làm việc")])]),t._v(" "),e("p",[t._v("-> Tổng thời gian từ lúc làm giấy tờ đến lúc có visa khoảng 3 tuần nhưng các bạn nên làm trước khoảng 2 tháng để đề phòng tính huống phát sinh.")])])}]};t.exports={attributes:{title:"Thủ tục visa thăm thân - bảo lãnh Bố Mẹ sang Nhật chơi",date:"2018-12-15T14:08:26.000Z",description:null,thumbnail:"posts/family.jpg",tags:["life"]},html:"<h2>Tham khảo</h2>\n<p>https://www.vn.emb-japan.go.jp/itpr_ja/VN_SVisaFAM.html</p>\n<h2>Người xin visa</h2>\n<ol>\n<li>\n<p>Hộ chiếu<br>\n-&gt; Bản gốc</p>\n</li>\n<li>\n<p>Tờ khai visa (có dán ảnh)<br>\n-&gt; 1 bản gốc<br>\nhttps://www.vn.emb-japan.go.jp/itpr_ja/VN_SVisaFAM.html</p>\n</li>\n<li>\n<p>Tài liệu chứng minh quan hệ họ hàng với người mời<br>\n-&gt; Sổ hộ khẩu: Mang theo 1 bản gốc và 1 bản photo</p>\n</li>\n<li>\n<p>Giấy tờ đặt vé (Khi nhận đc visa mới thanh toán)<br>\n-&gt; Bản gốc</p>\n</li>\n</ol>\n<h2>Người mời và bảo lãnh</h2>\n<ol>\n<li>\n<p>Giấy lý do mời<br>\n-&gt; BẢN GỐC<br>\n-&gt; Danh sách người xin visa<br>\n-&gt; Chú ý đóng dấu</p>\n</li>\n<li>\n<p>Lịch trình<br>\nChú ý là file này không thể lưu được nên viết xong phải in luôn</p>\n</li>\n</ol>\n<p><strong>Nếu người mời bảo lãnh sang thì cần thêm:</strong><br>\n3. Giấy chứng nhận bảo lãnh gồm<br>\n-&gt; Giấy chứng nhận bảo lãnh 1 BẢN GỐC -&gt; Chú ý đóng dầu<br>\n-&gt; Giấy chứng nhận nộp thuế có ghi tổng thu nhập<br>\n-&gt; Giấy số dư ngân hàng<br>\n-&gt; Phiếu công dân<br>\n-&gt; Photo 2 mặt thẻ ngoại kiều<br>\n-&gt; Photo hộ chiếu trang ảnh và trang liên quan đến xuất nhập cảnh và lưu trú<br>\n-&gt; Giấy chứng nhận đang làm việc xin từ công ty (在籍証明書)</p>\n<h2>Gửi giấy tờ về Việt Nam</h2>\n<ul>\n<li>Ra <strong>郵便局</strong> gửi chuyển phát nhanh EMS về Việt Nam.</li>\n<li>Chi phí hết khoảng 2000 yên tuỳ vùng</li>\n</ul>\n<h2>Sau bao lâu thì xong thủ tục</h2>\n<ul>\n<li>Khoảng 2 ngày - 1 tuần là nhận được là người ở Việt Nam nhận được giấy tờ</li>\n<li>Làm thủ tục ở Việt Nam mất khoảng 8 ngày làm việc</li>\n</ul>\n<p>-&gt; Tổng thời gian từ lúc làm giấy tờ đến lúc có visa khoảng 3 tuần nhưng các bạn nên làm trước khoảng 2 tháng để đề phòng tính huống phát sinh.</p>\n",meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/thu-tuc-moi-gia-dinh-sang-nhat-choi/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},352:function(t,n){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("p",[t._v("Nhìn chung do có sự khác biệt lớn về văn hoá và người Nhật thì thường kỹ tính nền người nước ngoài khá là khó thuê nhà ở Nhật.")]),t._v(" "),e("p",[t._v("Mình cũng từng trải qua vài lần thuê nhà nên xin chia sẻ 1 chút ở đây")]),t._v(" "),e("h2",[t._v("1. Share house")]),t._v(" "),e("p",[t._v("Nếu còn độc thân, thì share house là 1 lựa chọn khá tốt. Với chi phí hạn hẹp bạn vẫn có thể ở 1 căn nhà gần trung tâm và tiện nghi đầy đủ."),e("br"),t._v("\nĐặc biệt là thủ tục không lằng nhằng.")]),t._v(" "),e("h3",[t._v("Ưu điểm")]),t._v(" "),e("p",[t._v("Cơ bản thì 1 căn nhà lớn được chia làm nhiều phòng chung nhau nhà bếp và nhà tắm.\nTuỳ theo mức giá tiền thì chất lượng phòng sẽ khác nhau nhưng nhìn chung:")]),t._v(" "),e("ul",[e("li",[t._v("1 người/phòng, đầy đủ đồ chỉ việc xách valy vào ở")]),t._v(" "),e("li",[t._v("Các thiết bị như đồ bếp, nhà tắm khá mới và hiện đại, có người dọn vệ sinh hàng tuần và chuẩn bị giấy vệ sinh hay nước rửa bát, ...")]),t._v(" "),e("li",[t._v("Với giá cả tầm 5-8man là có thể ở gần khu trung tâm tokyo, rất tiện cho việc đi lại")]),t._v(" "),e("li",[t._v("Dễ dàng giao lưu kết bạn")])]),t._v(" "),e("h3",[t._v("Hạn chế")]),t._v(" "),e("ul",[e("li",[t._v("Tuy phòng riêng nhưng cách âm không tốt nên cần chú ý tiếng ồn.")])]),t._v(" "),e("p",[t._v("Chỗ mình từng ở thì mấy bạn nước ngoài như Brazil và Đức thì rất dễ nói chuyện và hay ngồi giao lưu với nhau nhưng thi thoảng cũng bị bạn Nhật than phiền về việc ồn ào.")]),t._v(" "),e("ul",[e("li",[t._v("Vẫn đề riêng tư như thư từ khá bất cập.")])]),t._v(" "),e("h3",[t._v("Thuê ở đâu?")]),t._v(" "),e("p",[t._v("Mình thuê ở chỗ này: https://gghouse.co.jp/\nHỗ trợ cả tiếng Anh, Việt, thủ tục rất dễ dàng")]),t._v(" "),e("h2",[t._v("2. Thuê nhà riêng")]),t._v(" "),e("p",[t._v("Cái này thì phức tạp hơn 1 chút và cũng đắt hơn sharehouse tương đối.\nCác công ty bất động sản đều có hỗ trợ người nước ngoài nên các bạn cứ mạnh dạn bước vào hỏi thôi\nCó các loại như")]),t._v(" "),e("ul",[e("li",[t._v("マンション: nhà chung cư")]),t._v(" "),e("li",[t._v("アパート: nhà trọ, thường là nhà thấp khoảng 2 - 3 tầng, giá tương đối rẻ")])]),t._v(" "),e("h3",[t._v("Chọn công ty BDS")]),t._v(" "),e("p",[t._v("Ra ga khu vực muốn thuê nhà rồi tìm cong ty bất động sản.")]),t._v(" "),e("p",[t._v("Mình chọn Able vì chi phí môi giới chỉ bằng nửa so với chố khác.")]),t._v(" "),e("h3",[t._v("Các khoản phí đầu vào")]),t._v(" "),e("ol",[e("li",[t._v("仲介料　Phí môi giới: 1/2 ~ 1 tháng tiền nhà")]),t._v(" "),e("li",[t._v("クリーニング　Phí dọn dẹp nhà lần đầu (tuỳ nhà), 0 ~ 1 tháng tiền nhà")]),t._v(" "),e("li",[t._v("鍵交換　Phí thay chìa khoá: 0 ~ 3man")]),t._v(" "),e("li",[t._v("敷金　Đặt cọc từ 1 ~ 2 tháng tiền nhà")]),t._v(" "),e("li",[t._v("礼金 Tiền lễ 0 ~ 2 tháng tiền nhà")]),t._v(" "),e("li",[t._v("保証料　Phí thuê công ty bảo lãnh thuê nhà 1 man ~ 1tháng tiền nhà")])]),t._v(" "),e("p",[t._v("Khoản này hầu như là bắt buộc. Công ty này sẽ đứng ra chịu trách nhiệm với bên cho thuê về việc đóng tiền nhà hàng tháng của bạn\n7. Ngoài ra tuỳ nhà còn phải nộp thêm 2 - 4 tháng tiền nhà trước")]),t._v(" "),e("p",[t._v("Phù😂")]),t._v(" "),e("h3",[t._v("Phí thường niên")]),t._v(" "),e("ol",[e("li",[t._v("保証料: 1 năm 1 lần")]),t._v(" "),e("li",[t._v("更新料 phí gia hạn hợp đồng, 2 năm 1 lần 1 ~ 2 tháng tiền nhà")])])])}]};t.exports={attributes:{title:"Thuê nhà ở Nhật",date:"2018-04-12T00:37:11.000Z",thumbnail:"posts/house.jpg",tags:["life"]},html:"<p>Nhìn chung do có sự khác biệt lớn về văn hoá và người Nhật thì thường kỹ tính nền người nước ngoài khá là khó thuê nhà ở Nhật.</p>\n<p>Mình cũng từng trải qua vài lần thuê nhà nên xin chia sẻ 1 chút ở đây</p>\n<h2>1. Share house</h2>\n<p>Nếu còn độc thân, thì share house là 1 lựa chọn khá tốt. Với chi phí hạn hẹp bạn vẫn có thể ở 1 căn nhà gần trung tâm và tiện nghi đầy đủ.<br>\nĐặc biệt là thủ tục không lằng nhằng.</p>\n<h3>Ưu điểm</h3>\n<p>Cơ bản thì 1 căn nhà lớn được chia làm nhiều phòng chung nhau nhà bếp và nhà tắm.\nTuỳ theo mức giá tiền thì chất lượng phòng sẽ khác nhau nhưng nhìn chung:</p>\n<ul>\n<li>1 người/phòng, đầy đủ đồ chỉ việc xách valy vào ở</li>\n<li>Các thiết bị như đồ bếp, nhà tắm khá mới và hiện đại, có người dọn vệ sinh hàng tuần và chuẩn bị giấy vệ sinh hay nước rửa bát, ...</li>\n<li>Với giá cả tầm 5-8man là có thể ở gần khu trung tâm tokyo, rất tiện cho việc đi lại</li>\n<li>Dễ dàng giao lưu kết bạn</li>\n</ul>\n<h3>Hạn chế</h3>\n<ul>\n<li>Tuy phòng riêng nhưng cách âm không tốt nên cần chú ý tiếng ồn.</li>\n</ul>\n<p>Chỗ mình từng ở thì mấy bạn nước ngoài như Brazil và Đức thì rất dễ nói chuyện và hay ngồi giao lưu với nhau nhưng thi thoảng cũng bị bạn Nhật than phiền về việc ồn ào.</p>\n<ul>\n<li>Vẫn đề riêng tư như thư từ khá bất cập.</li>\n</ul>\n<h3>Thuê ở đâu?</h3>\n<p>Mình thuê ở chỗ này: https://gghouse.co.jp/\nHỗ trợ cả tiếng Anh, Việt, thủ tục rất dễ dàng</p>\n<h2>2. Thuê nhà riêng</h2>\n<p>Cái này thì phức tạp hơn 1 chút và cũng đắt hơn sharehouse tương đối.\nCác công ty bất động sản đều có hỗ trợ người nước ngoài nên các bạn cứ mạnh dạn bước vào hỏi thôi\nCó các loại như</p>\n<ul>\n<li>マンション: nhà chung cư</li>\n<li>アパート: nhà trọ, thường là nhà thấp khoảng 2 - 3 tầng, giá tương đối rẻ</li>\n</ul>\n<h3>Chọn công ty BDS</h3>\n<p>Ra ga khu vực muốn thuê nhà rồi tìm cong ty bất động sản.</p>\n<p>Mình chọn Able vì chi phí môi giới chỉ bằng nửa so với chố khác.</p>\n<h3>Các khoản phí đầu vào</h3>\n<ol>\n<li>仲介料　Phí môi giới: 1/2 ~ 1 tháng tiền nhà</li>\n<li>クリーニング　Phí dọn dẹp nhà lần đầu (tuỳ nhà), 0 ~ 1 tháng tiền nhà</li>\n<li>鍵交換　Phí thay chìa khoá: 0 ~ 3man</li>\n<li>敷金　Đặt cọc từ 1 ~ 2 tháng tiền nhà</li>\n<li>礼金 Tiền lễ 0 ~ 2 tháng tiền nhà</li>\n<li>保証料　Phí thuê công ty bảo lãnh thuê nhà 1 man ~ 1tháng tiền nhà</li>\n</ol>\n<p>Khoản này hầu như là bắt buộc. Công ty này sẽ đứng ra chịu trách nhiệm với bên cho thuê về việc đóng tiền nhà hàng tháng của bạn\n7. Ngoài ra tuỳ nhà còn phải nộp thêm 2 - 4 tháng tiền nhà trước</p>\n<p>Phù😂</p>\n<h3>Phí thường niên</h3>\n<ol>\n<li>保証料: 1 năm 1 lần</li>\n<li>更新料 phí gia hạn hợp đồng, 2 năm 1 lần 1 ~ 2 tháng tiền nhà</li>\n</ol>\n",meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/thue-nha-o-nhat/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},353:function(t,n){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("p",[t._v("最近セキュリティ考慮したシステム設計を経験したので、メモします。")]),t._v(" "),e("h2",[t._v("1. ユーザー認証")]),t._v(" "),e("ul",[e("li",[t._v("[ ] ログイン失敗する際詳しメッセージが出さない")]),t._v(" "),e("li",[t._v("[ ] 指定回数でログイン失敗したらアカウントロックをかかる")]),t._v(" "),e("li",[t._v("[ ] アカウントロックをかかった際管理者にメール等で通知")]),t._v(" "),e("li",[t._v("[ ] パースワードの有効期限を実装")]),t._v(" "),e("li",[t._v("[ ] パースワード変更するには現在のパースワードが必要")]),t._v(" "),e("li",[t._v("[ ] 直接パースワードはDBに保存しない")])]),t._v(" "),e("h2",[t._v("2. 権限制御")]),t._v(" "),e("ul",[e("li",[t._v("[ ] 直接URLをアクセス許可かどうか検討")]),t._v(" "),e("li",[t._v("[ ] 各アクションは実行する前に権限をチェックする ボタンの表示、非表示等ではなくロジック実装である。")]),t._v(" "),e("li",[t._v("[ ] ブラウザの戻るボタンを要注意")])]),t._v(" "),e("h2",[t._v("3. セッション管理")]),t._v(" "),e("ul",[e("li",[t._v("[ ] Cookieセンシティブデーターを持たない")]),t._v(" "),e("li",[t._v("[ ] SessionIdはユニックであり、サーバー側にてアサインするべき")]),t._v(" "),e("li",[t._v("[ ] SessionIdは推測しにくい")]),t._v(" "),e("li",[t._v("[ ] SessionIdはできればライフタイムが短く設定するべき")]),t._v(" "),e("li",[t._v("[ ] ログアウトする際SessionIdは廃棄するべき")]),t._v(" "),e("li",[t._v("[ ] CookieはHttpOnly,Secure属性設定するべき")]),t._v(" "),e("li",[t._v("[ ] パーマネントCookieよりセッションCookieを使用したほうが良い")])]),t._v(" "),e("h2",[t._v("4. バリデーション")]),t._v(" "),e("ul",[e("li",[t._v("[ ] クライアントからのデータは信頼性がゼロとして必ずサーバーサイドバリデーション実装")]),t._v(" "),e("li",[t._v("[ ] HTML特殊文字、危険な文字等エスケープするべき")])]),t._v(" "),e("h2",[t._v("5. クロスサイトスクリプティング")]),t._v(" "),e("ul",[e("li",[t._v("[ ] 動的な内容を表示する箇所はすべてHTMLエスケープするか確認")]),t._v(" "),e("li",[t._v("[ ] Query stringのデータは直接表示させない")])]),t._v(" "),e("h2",[t._v("6. コマンドインジェクション")]),t._v(" "),e("ul",[e("li",[t._v("[ ] シェルコマンドが直接呼び出す際パラメータエスケープをするべきだ")])]),t._v(" "),e("h2",[t._v("7. SQLインジェクション")]),t._v(" "),e("ul",[e("li",[t._v("[ ] SQLを組み立てる際ストリング結合ではなくすべてprepare statementを使用するべき")])]),t._v(" "),e("h2",[t._v("8. バッファオーバーフロー")]),t._v(" "),e("ul",[e("li",[t._v("[ ] すべてのリクエストデータは最大値をバリデーションする")])]),t._v(" "),e("h2",[t._v("9. 暗号化,秘密情報")]),t._v(" "),e("ul",[e("li",[t._v("[ ] 認証されたアルゴリズムを使用すること")]),t._v(" "),e("li",[t._v("[ ] 秘密鍵、DB情報等を持っている.envファイルは保護すること")])]),t._v(" "),e("h2",[t._v("10. エラーハンドリング")]),t._v(" "),e("ul",[e("li",[t._v("[ ] エラーになった際エラー情報をユーザーに見せないこと")])]),t._v(" "),e("h2",[t._v("11. ロギング")]),t._v(" "),e("ul",[e("li",[t._v("[ ] ログには日付、タイプ、詳細情報が出される")])]),t._v(" "),e("h2",[t._v("12. サーバー設定")]),t._v(" "),e("ul",[e("li",[t._v("[ ] Debugモードオフする")]),t._v(" "),e("li",[t._v("[ ] すべてリクエストはHTTPSを介すること")]),t._v(" "),e("li",[t._v("[ ] Apacheサーバーの場合はApacheチェックリスト参照する")])])])}]};t.exports={attributes:{title:"[Security]Web Application Security Checklist",date:"2017-12-11T14:25:22.000Z",thumbnail:"posts/security.jpg",draft:!1,tags:["security"]},html:"<p>最近セキュリティ考慮したシステム設計を経験したので、メモします。</p>\n<h2>1. ユーザー認証</h2>\n<ul>\n<li>[ ] ログイン失敗する際詳しメッセージが出さない</li>\n<li>[ ] 指定回数でログイン失敗したらアカウントロックをかかる</li>\n<li>[ ] アカウントロックをかかった際管理者にメール等で通知</li>\n<li>[ ] パースワードの有効期限を実装</li>\n<li>[ ] パースワード変更するには現在のパースワードが必要</li>\n<li>[ ] 直接パースワードはDBに保存しない</li>\n</ul>\n<h2>2. 権限制御</h2>\n<ul>\n<li>[ ] 直接URLをアクセス許可かどうか検討</li>\n<li>[ ] 各アクションは実行する前に権限をチェックする ボタンの表示、非表示等ではなくロジック実装である。</li>\n<li>[ ] ブラウザの戻るボタンを要注意</li>\n</ul>\n<h2>3. セッション管理</h2>\n<ul>\n<li>[ ] Cookieセンシティブデーターを持たない</li>\n<li>[ ] SessionIdはユニックであり、サーバー側にてアサインするべき</li>\n<li>[ ] SessionIdは推測しにくい</li>\n<li>[ ] SessionIdはできればライフタイムが短く設定するべき</li>\n<li>[ ] ログアウトする際SessionIdは廃棄するべき</li>\n<li>[ ] CookieはHttpOnly,Secure属性設定するべき</li>\n<li>[ ] パーマネントCookieよりセッションCookieを使用したほうが良い</li>\n</ul>\n<h2>4. バリデーション</h2>\n<ul>\n<li>[ ] クライアントからのデータは信頼性がゼロとして必ずサーバーサイドバリデーション実装</li>\n<li>[ ] HTML特殊文字、危険な文字等エスケープするべき</li>\n</ul>\n<h2>5. クロスサイトスクリプティング</h2>\n<ul>\n<li>[ ] 動的な内容を表示する箇所はすべてHTMLエスケープするか確認</li>\n<li>[ ] Query stringのデータは直接表示させない</li>\n</ul>\n<h2>6. コマンドインジェクション</h2>\n<ul>\n<li>[ ] シェルコマンドが直接呼び出す際パラメータエスケープをするべきだ</li>\n</ul>\n<h2>7. SQLインジェクション</h2>\n<ul>\n<li>[ ] SQLを組み立てる際ストリング結合ではなくすべてprepare statementを使用するべき</li>\n</ul>\n<h2>8. バッファオーバーフロー</h2>\n<ul>\n<li>[ ] すべてのリクエストデータは最大値をバリデーションする</li>\n</ul>\n<h2>9. 暗号化,秘密情報</h2>\n<ul>\n<li>[ ] 認証されたアルゴリズムを使用すること</li>\n<li>[ ] 秘密鍵、DB情報等を持っている.envファイルは保護すること</li>\n</ul>\n<h2>10. エラーハンドリング</h2>\n<ul>\n<li>[ ] エラーになった際エラー情報をユーザーに見せないこと</li>\n</ul>\n<h2>11. ロギング</h2>\n<ul>\n<li>[ ] ログには日付、タイプ、詳細情報が出される</li>\n</ul>\n<h2>12. サーバー設定</h2>\n<ul>\n<li>[ ] Debugモードオフする</li>\n<li>[ ] すべてリクエストはHTTPSを介すること</li>\n<li>[ ] Apacheサーバーの場合はApacheチェックリスト参照する</li>\n</ul>\n",meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/web-application-security-checklist/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},354:function(t,n){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("p",[t._v("while developing in languages that are case-insensitive like "),e("code",{pre:!0},[t._v("php")]),t._v(", be careful if development OS and production OS are acting differently at case-sensitivity, otherwise, some weird things will happen.")]),t._v(" "),e("p",[t._v("For example, the code below works well in Windows")]),t._v(" "),e("pre",{staticClass:"language-php"},[e("code",{pre:!0,attrs:{class:"language-php"}},[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// filename: app/Models/Userorder.php")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token package"}},[t._v("App"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Models")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserOrder")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("p",[t._v("usage")]),t._v(" "),e("pre",{staticClass:"language-php"},[e("code",{pre:!0,attrs:{class:"language-php"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("App"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Models"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("UserOrder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n")])]),t._v(" "),e("blockquote",[e("p",[t._v("Did you notice the difference between "),e("strong",[t._v("file name")]),t._v(" and "),e("strong",[t._v("class name")]),t._v("?")])]),t._v(" "),e("p",[t._v("Because "),e("strong",[t._v("php")]),t._v(" use "),e("strong",[t._v("autoload")]),t._v(" to correctly load the file and class at runtime, in the declaration")]),t._v(" "),e("pre",{staticClass:"language-php"},[e("code",{pre:!0,attrs:{class:"language-php"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("App"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Models"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("UserOrder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("p",[t._v("first it will try loading the file app/Models/"),e("strong",[t._v("UserOrder.php")]),t._v(" and instance "),e("strong",[t._v("UserOrder")]),t._v(" object.")]),t._v(" "),e("p",[t._v("As Windows is case-insensitive, "),e("strong",[t._v("UserOrder.php")]),t._v(" == "),e("strong",[t._v("Userorder.php")]),t._v(", no problem here, but in Linux, you will get")]),t._v(" "),e("blockquote",[e("p",[t._v("Fatal error: Class UrderOrder not found")])]),t._v(" "),e("p",[t._v("In that case, change the file name that matches the class name")]),t._v(" "),e("pre",{staticClass:"language-sh"},[e("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("app/Models/Userorder.php -> app/Models/UserOrder.php\n")])])])}]};t.exports={attributes:{title:"[PHP]Windows Case Insensitive Problem",date:"2017-05-24T21:05:03.000Z",thumbnail:"posts/case.jpg",tags:["php"]},html:'<p>while developing in languages that are case-insensitive like <code>php</code>, be careful if development OS and production OS are acting differently at case-sensitivity, otherwise, some weird things will happen.</p>\n<p>For example, the code below works well in Windows</p>\n<pre class="language-php"><code class="language-php"><span class="token comment">// filename: app/Models/Userorder.php</span>\n<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\\</span>Models</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">UserOrder</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>usage</p>\n<pre class="language-php"><code class="language-php"><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\\</span>App<span class="token punctuation">\\</span>Models<span class="token punctuation">\\</span>UserOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> \n</code></pre>\n<blockquote>\n<p>Did you notice the difference between <strong>file name</strong> and <strong>class name</strong>?</p>\n</blockquote>\n<p>Because <strong>php</strong> use <strong>autoload</strong> to correctly load the file and class at runtime, in the declaration</p>\n<pre class="language-php"><code class="language-php"><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\\</span>App<span class="token punctuation">\\</span>Models<span class="token punctuation">\\</span>UserOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>first it will try loading the file app/Models/<strong>UserOrder.php</strong> and instance <strong>UserOrder</strong> object.</p>\n<p>As Windows is case-insensitive, <strong>UserOrder.php</strong> == <strong>Userorder.php</strong>, no problem here, but in Linux, you will get</p>\n<blockquote>\n<p>Fatal error: Class UrderOrder not found</p>\n</blockquote>\n<p>In that case, change the file name that matches the class name</p>\n<pre class="language-sh"><code class="language-sh">app/Models/Userorder.php -&gt; app/Models/UserOrder.php\n</code></pre>\n',meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/windows-case-insensitive-problem/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},356:function(t,n,e){var map={"./af":204,"./af.js":204,"./ar":205,"./ar-dz":206,"./ar-dz.js":206,"./ar-kw":207,"./ar-kw.js":207,"./ar-ly":208,"./ar-ly.js":208,"./ar-ma":209,"./ar-ma.js":209,"./ar-sa":210,"./ar-sa.js":210,"./ar-tn":211,"./ar-tn.js":211,"./ar.js":205,"./az":212,"./az.js":212,"./be":213,"./be.js":213,"./bg":214,"./bg.js":214,"./bm":215,"./bm.js":215,"./bn":216,"./bn.js":216,"./bo":217,"./bo.js":217,"./br":218,"./br.js":218,"./bs":219,"./bs.js":219,"./ca":220,"./ca.js":220,"./cs":221,"./cs.js":221,"./cv":222,"./cv.js":222,"./cy":223,"./cy.js":223,"./da":224,"./da.js":224,"./de":225,"./de-at":226,"./de-at.js":226,"./de-ch":227,"./de-ch.js":227,"./de.js":225,"./dv":228,"./dv.js":228,"./el":229,"./el.js":229,"./en-au":230,"./en-au.js":230,"./en-ca":231,"./en-ca.js":231,"./en-gb":232,"./en-gb.js":232,"./en-ie":233,"./en-ie.js":233,"./en-il":234,"./en-il.js":234,"./en-in":235,"./en-in.js":235,"./en-nz":236,"./en-nz.js":236,"./en-sg":237,"./en-sg.js":237,"./eo":238,"./eo.js":238,"./es":239,"./es-do":240,"./es-do.js":240,"./es-us":241,"./es-us.js":241,"./es.js":239,"./et":242,"./et.js":242,"./eu":243,"./eu.js":243,"./fa":244,"./fa.js":244,"./fi":245,"./fi.js":245,"./fil":246,"./fil.js":246,"./fo":247,"./fo.js":247,"./fr":248,"./fr-ca":249,"./fr-ca.js":249,"./fr-ch":250,"./fr-ch.js":250,"./fr.js":248,"./fy":251,"./fy.js":251,"./ga":252,"./ga.js":252,"./gd":253,"./gd.js":253,"./gl":254,"./gl.js":254,"./gom-deva":255,"./gom-deva.js":255,"./gom-latn":256,"./gom-latn.js":256,"./gu":257,"./gu.js":257,"./he":258,"./he.js":258,"./hi":259,"./hi.js":259,"./hr":260,"./hr.js":260,"./hu":261,"./hu.js":261,"./hy-am":262,"./hy-am.js":262,"./id":263,"./id.js":263,"./is":264,"./is.js":264,"./it":265,"./it-ch":266,"./it-ch.js":266,"./it.js":265,"./ja":267,"./ja.js":267,"./jv":268,"./jv.js":268,"./ka":269,"./ka.js":269,"./kk":270,"./kk.js":270,"./km":271,"./km.js":271,"./kn":272,"./kn.js":272,"./ko":273,"./ko.js":273,"./ku":274,"./ku.js":274,"./ky":275,"./ky.js":275,"./lb":276,"./lb.js":276,"./lo":277,"./lo.js":277,"./lt":278,"./lt.js":278,"./lv":279,"./lv.js":279,"./me":280,"./me.js":280,"./mi":281,"./mi.js":281,"./mk":282,"./mk.js":282,"./ml":283,"./ml.js":283,"./mn":284,"./mn.js":284,"./mr":285,"./mr.js":285,"./ms":286,"./ms-my":287,"./ms-my.js":287,"./ms.js":286,"./mt":288,"./mt.js":288,"./my":289,"./my.js":289,"./nb":290,"./nb.js":290,"./ne":291,"./ne.js":291,"./nl":292,"./nl-be":293,"./nl-be.js":293,"./nl.js":292,"./nn":294,"./nn.js":294,"./oc-lnc":295,"./oc-lnc.js":295,"./pa-in":296,"./pa-in.js":296,"./pl":297,"./pl.js":297,"./pt":298,"./pt-br":299,"./pt-br.js":299,"./pt.js":298,"./ro":300,"./ro.js":300,"./ru":301,"./ru.js":301,"./sd":302,"./sd.js":302,"./se":303,"./se.js":303,"./si":304,"./si.js":304,"./sk":305,"./sk.js":305,"./sl":306,"./sl.js":306,"./sq":307,"./sq.js":307,"./sr":308,"./sr-cyrl":309,"./sr-cyrl.js":309,"./sr.js":308,"./ss":310,"./ss.js":310,"./sv":311,"./sv.js":311,"./sw":312,"./sw.js":312,"./ta":313,"./ta.js":313,"./te":314,"./te.js":314,"./tet":315,"./tet.js":315,"./tg":316,"./tg.js":316,"./th":317,"./th.js":317,"./tl-ph":318,"./tl-ph.js":318,"./tlh":319,"./tlh.js":319,"./tr":320,"./tr.js":320,"./tzl":321,"./tzl.js":321,"./tzm":322,"./tzm-latn":323,"./tzm-latn.js":323,"./tzm.js":322,"./ug-cn":324,"./ug-cn.js":324,"./uk":325,"./uk.js":325,"./ur":326,"./ur.js":326,"./uz":327,"./uz-latn":328,"./uz-latn.js":328,"./uz.js":327,"./vi":329,"./vi.js":329,"./x-pseudo":330,"./x-pseudo.js":330,"./yo":331,"./yo.js":331,"./zh-cn":332,"./zh-cn.js":332,"./zh-hk":333,"./zh-hk.js":333,"./zh-mo":334,"./zh-mo.js":334,"./zh-tw":335,"./zh-tw.js":335};function c(t){var n=r(t);return e(n)}function r(t){if(!e.o(map,t)){var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}return map[t]}c.keys=function(){return Object.keys(map)},c.resolve=r,t.exports=c,c.id=356},358:function(t,n,e){"use strict";e(17);var c=e(203),r=e.n(c),l={name:"ArticleComponent",props:["post"],created:function(){console.log(this.post)},data:function(){return{prefix:"posts"}},computed:{title:function(){return this.post.attributes.title},tags:function(){return this.post.attributes.tags||[]},description:function(){return this.post.attributes.description},thumbnail:function(){return this.post.attributes.thumbnail||"/images/default-thumbnail.jpg"},date:function(){return r()(this.post.attributes.date,"YYYY-MM-DD").format("Do MMM YYYY")},permalink:function(){var t=this.post;if(t.attributes.hasOwnProperty("permalink"))return"".concat(this.prefix,"/").concat(t.attributes.permalink);var path,n=t.meta.resourcePath.split("\\").pop().split("/"),e=n.pop();return path="index.md"===e?n.pop():e.split(".")[0],"".concat(this.prefix,"/").concat(path)}}},o=e(33),component=Object(o.a)(l,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("article",{staticClass:"d-flex flex-column pb-5"},[e("div",{staticClass:"image"},[e("nuxt-link",{staticClass:"text-left font-weight-bold",attrs:{tag:"a",to:t.permalink}},[e("picture",[e("img",{attrs:{src:t.thumbnail,onerror:"this.src='/images/default-thumbnail.jpg'",alt:""}})])])],1),t._v(" "),e("h3",{staticClass:"mt-3"},[t._v(t._s(t.title))]),t._v(" "),e("span",{staticClass:"text-right text-muted caption"},[t._v(t._s(t.date))]),t._v(" "),e("p",[t._v(t._s(t.description))]),t._v(" "),e("div",{staticClass:"tags pt-0 mb-3 mt-0"},t._l(t.tags,(function(n,c){return e("a",{key:c,attrs:{href:"#"}},[t._v(t._s(n))])})),0),t._v(" "),e("nuxt-link",{staticClass:"text-left font-weight-bold",attrs:{tag:"a",to:t.permalink}},[t._v("\n    Read more\n  ")])],1)}),[],!1,null,null,null);n.a=component.exports}}]);