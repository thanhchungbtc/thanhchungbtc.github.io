(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{346:function(e,n){const t={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"frontmatter-markdown"},[t("p",[e._v("特に大した改修をしていないのに、システムをstagingでリリースした時、いきなり前面的に止まったので、結構ハマった。\n小さなことですごく影響が多いなと感じでした。")]),e._v(" "),t("h2",[e._v("問題")]),e._v(" "),t("p",[e._v("Linuxサーバへデプロイした時、Responseコード200にも関わらず、「"),t("strong",[e._v("Gzipが不正よ")]),e._v("」と文句言われ、ブラウザ開けないことがあった。")]),e._v(" "),t("h2",[e._v("原因")]),e._v(" "),t("p",[e._v("かなりレガシシステムなので、"),t("code",{pre:!0},[e._v('ob_start("ob_gzhandler");')]),e._v("で"),t("code",{pre:!0},[e._v("gzip")]),e._v("レスポンスを作っている。\n"),t("strong",[e._v("gzip")]),e._v("レスポンスを分析したところ、PHPソースファイルにBOMが入っていて、正しくないGzipファイルを作って送信したような原因だった。")]),e._v(" "),t("p",[e._v("※BOMは"),t("strong",[e._v("EF BB BF")]),e._v("で確認可能")]),e._v(" "),t("p",[e._v("Windows上のエディターでは「"),t("strong",[e._v("UTF-8 BOM付で保存")]),e._v("」というエディターの設定があり、この設定でファイル保存かもしれない。")]),e._v(" "),t("h2",[e._v("対策")]),e._v(" "),t("p",[e._v("全て"),t("strong",[e._v("UTF-8 BOM付")]),e._v("のソースファイルを抽出し、BOMを消せば、正常に動いた。")]),e._v(" "),t("h3",[e._v("BOM付きファイル抽出")]),e._v(" "),t("pre",{staticClass:"language-sh"},[t("code",{pre:!0,attrs:{class:"language-sh"}},[e._v("grep -rl $'\\xEF\\xBB\\xBF' .\n")])]),e._v(" "),t("h3",[e._v("BOMを排除する")]),e._v(" "),t("pre",{staticClass:"language-sh"},[t("code",{pre:!0,attrs:{class:"language-sh"}},[e._v("sed -i '1 s/^\\xef\\xbb\\xbf//' *.php\n")])])])}]};e.exports={attributes:{title:"[PHP]UTF-8 BOMにやられた",date:"2018-02-13T10:16:40.000Z",description:"",thumbnail:"posts/bom.jpeg",tags:["php","bom"]},html:'<p>特に大した改修をしていないのに、システムをstagingでリリースした時、いきなり前面的に止まったので、結構ハマった。\n小さなことですごく影響が多いなと感じでした。</p>\n<h2>問題</h2>\n<p>Linuxサーバへデプロイした時、Responseコード200にも関わらず、「<strong>Gzipが不正よ</strong>」と文句言われ、ブラウザ開けないことがあった。</p>\n<h2>原因</h2>\n<p>かなりレガシシステムなので、<code>ob_start(&quot;ob_gzhandler&quot;);</code>で<code>gzip</code>レスポンスを作っている。\n<strong>gzip</strong>レスポンスを分析したところ、PHPソースファイルにBOMが入っていて、正しくないGzipファイルを作って送信したような原因だった。</p>\n<p>※BOMは<strong>EF BB BF</strong>で確認可能</p>\n<p>Windows上のエディターでは「<strong>UTF-8 BOM付で保存</strong>」というエディターの設定があり、この設定でファイル保存かもしれない。</p>\n<h2>対策</h2>\n<p>全て<strong>UTF-8 BOM付</strong>のソースファイルを抽出し、BOMを消せば、正常に動いた。</p>\n<h3>BOM付きファイル抽出</h3>\n<pre class="language-sh"><code class="language-sh">grep -rl $\'\\xEF\\xBB\\xBF\' .\n</code></pre>\n<h3>BOMを排除する</h3>\n<pre class="language-sh"><code class="language-sh">sed -i \'1 s/^\\xef\\xbb\\xbf//\' *.php\n</code></pre>\n',meta:{resourcePath:"/Volumes/Data/github.com/thanhchungbtc/myblog/content/php-suck-bom-utf8/index.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(e){return this.templateRender?this.templateRender():e("div","Rendering")},created:function(){this.templateRender=t.render,this.$options.staticRenderFns=t.staticRenderFns}}}}}}]);